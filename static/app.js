(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();const fr=!1;var tr=Array.isArray,ia=Array.prototype.indexOf,rr=Array.from,la=Object.defineProperty,rt=Object.getOwnPropertyDescriptor,oa=Object.getOwnPropertyDescriptors,ca=Object.prototype,ua=Array.prototype,Sr=Object.getPrototypeOf,_r=Object.isExtensible;const va=()=>{};function da(e){for(var t=0;t<e.length;t++)e[t]()}const Te=2,jr=4,Ft=8,ar=16,Ie=32,st=64,Ct=128,be=256,Tt=512,pe=1024,je=2048,Ke=4096,Pe=8192,Rt=16384,fa=32768,Mt=65536,_a=1<<19,Or=1<<20,Kt=1<<21,dt=Symbol("$state"),ha=Symbol("legacy props"),pa=Symbol("");function Dr(e){return e===this.v}function wa(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function nr(e){return!wa(e,this.v)}function ba(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ga(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function ma(e){throw new Error("https://svelte.dev/e/effect_orphan")}function ya(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function xa(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ea(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ca(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ta(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let ka=!1;const sr=1,ir=2,Pr=4,za=8,Sa=16,ja=1,Oa=4,Da=8,Pa=16,Na=1,Aa=2,fe=Symbol(),Ia="http://www.w3.org/1999/xhtml";let ge=null;function hr(e){ge=e}function He(e,t=!1,r){var a=ge={p:ge,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};Hr(()=>{a.d=!0})}function qe(e){const t=ge;if(t!==null){const o=t.e;if(o!==null){var r=J,a=B;t.e=null;try{for(var s=0;s<o.length;s++){var n=o[s];Le(n.effect),Oe(n.reaction),or(n.fn)}}finally{Le(r),Oe(a)}}ge=t.p,t.m=!0}return{}}function Nr(){return!0}function _e(e){if(typeof e!="object"||e===null||dt in e)return e;const t=Sr(e);if(t!==ca&&t!==ua)return e;var r=new Map,a=tr(e),s=k(0),n=B,o=v=>{var u=B;Oe(n);var c=v();return Oe(u),c};return a&&r.set("length",k(e.length)),new Proxy(e,{defineProperty(v,u,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&Ea();var f=r.get(u);return f===void 0?(f=o(()=>k(c.value)),r.set(u,f)):d(f,o(()=>_e(c.value))),!0},deleteProperty(v,u){var c=r.get(u);if(c===void 0)u in v&&(r.set(u,o(()=>k(fe))),Ut(s));else{if(a&&typeof u=="string"){var f=r.get("length"),h=Number(u);Number.isInteger(h)&&h<f.v&&d(f,h)}d(c,fe),Ut(s)}return!0},get(v,u,c){var p;if(u===dt)return e;var f=r.get(u),h=u in v;if(f===void 0&&(!h||(p=rt(v,u))!=null&&p.writable)&&(f=o(()=>k(_e(h?v[u]:fe))),r.set(u,f)),f!==void 0){var l=i(f);return l===fe?void 0:l}return Reflect.get(v,u,c)},getOwnPropertyDescriptor(v,u){var c=Reflect.getOwnPropertyDescriptor(v,u);if(c&&"value"in c){var f=r.get(u);f&&(c.value=i(f))}else if(c===void 0){var h=r.get(u),l=h==null?void 0:h.v;if(h!==void 0&&l!==fe)return{enumerable:!0,configurable:!0,value:l,writable:!0}}return c},has(v,u){var l;if(u===dt)return!0;var c=r.get(u),f=c!==void 0&&c.v!==fe||Reflect.has(v,u);if(c!==void 0||J!==null&&(!f||(l=rt(v,u))!=null&&l.writable)){c===void 0&&(c=o(()=>k(f?_e(v[u]):fe)),r.set(u,c));var h=i(c);if(h===fe)return!1}return f},set(v,u,c,f){var T;var h=r.get(u),l=u in v;if(a&&u==="length")for(var p=c;p<h.v;p+=1){var b=r.get(p+"");b!==void 0?d(b,fe):p in v&&(b=o(()=>k(fe)),r.set(p+"",b))}h===void 0?(!l||(T=rt(v,u))!=null&&T.writable)&&(h=o(()=>k(void 0)),d(h,o(()=>_e(c))),r.set(u,h)):(l=h.v!==fe,d(h,o(()=>_e(c))));var m=Reflect.getOwnPropertyDescriptor(v,u);if(m!=null&&m.set&&m.set.call(f,c),!l){if(a&&typeof u=="string"){var E=r.get("length"),C=Number(u);Number.isInteger(C)&&C>=E.v&&d(E,C+1)}Ut(s)}return!0},ownKeys(v){i(s);var u=Reflect.ownKeys(v).filter(h=>{var l=r.get(h);return l===void 0||l.v!==fe});for(var[c,f]of r)f.v!==fe&&!(c in v)&&u.push(c);return u},setPrototypeOf(){Ca()}})}function Ut(e,t=1){d(e,e.v+t)}function Wt(e){var t=Te|je,r=B!==null&&(B.f&Te)!==0?B:null;return J===null||r!==null&&(r.f&be)!==0?t|=be:J.f|=Or,{ctx:ge,deps:null,effects:null,equals:Dr,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:r??J}}function kt(e){const t=Wt(e);return Kr(t),t}function $a(e){const t=Wt(e);return t.equals=nr,t}function Ar(e){var t=e.effects;if(t!==null){e.effects=null;for(var r=0;r<t.length;r+=1)Ae(t[r])}}function Fa(e){for(var t=e.parent;t!==null;){if((t.f&Te)===0)return t;t=t.parent}return null}function Ir(e){var t,r=J;Le(Fa(e));try{Ar(e),t=ea(e)}finally{Le(r)}return t}function $r(e){var t=Ir(e),r=(Me||(e.f&be)!==0)&&e.deps!==null?Ke:pe;ke(e,r),e.equals(t)||(e.v=t,e.wv=Xr())}const ft=new Map;function zt(e,t){var r={f:0,v:e,reactions:null,equals:Dr,rv:0,wv:0};return r}function k(e,t){const r=zt(e);return Kr(r),r}function Fr(e,t=!1){const r=zt(e);return t||(r.equals=nr),r}function d(e,t,r=!1){B!==null&&!Se&&Nr()&&(B.f&(Te|ar))!==0&&!(ve!=null&&ve.includes(e))&&Ta();let a=r?_e(t):t;return Zt(e,a)}function Zt(e,t){if(!e.equals(t)){var r=e.v;ht?ft.set(e,t):ft.set(e,r),e.v=t,(e.f&Te)!==0&&((e.f&je)!==0&&Ir(e),ke(e,(e.f&be)===0?pe:Ke)),e.wv=Xr(),Rr(e,je),J!==null&&(J.f&pe)!==0&&(J.f&(Ie|st))===0&&(xe===null?Ya([e]):xe.push(e))}return t}function Rr(e,t){var r=e.reactions;if(r!==null)for(var a=r.length,s=0;s<a;s++){var n=r[s],o=n.f;(o&je)===0&&(ke(n,t),(o&(pe|be))!==0&&((o&Te)!==0?Rr(n,Ke):Bt(n)))}}let Ra=!1;var pr,Mr,Wr,Lr;function Ma(){if(pr===void 0){pr=window,Mr=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,r=Text.prototype;Wr=rt(t,"firstChild").get,Lr=rt(t,"nextSibling").get,_r(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),_r(r)&&(r.__t=void 0)}}function lr(e=""){return document.createTextNode(e)}function Re(e){return Wr.call(e)}function Lt(e){return Lr.call(e)}function _(e,t){return Re(e)}function at(e,t){{var r=Re(e);return r instanceof Comment&&r.data===""?Lt(r):r}}function w(e,t=1,r=!1){let a=e;for(;t--;)a=Lt(a);return a}function Wa(e){e.textContent=""}function La(e){J===null&&B===null&&ma(),B!==null&&(B.f&be)!==0&&J===null&&ga(),ht&&ba()}function Ha(e,t){var r=t.last;r===null?t.last=t.first=e:(r.next=e,e.prev=r,t.last=e)}function it(e,t,r,a=!0){var s=J,n={ctx:ge,deps:null,nodes_start:null,nodes_end:null,f:e|je,first:null,fn:t,last:null,next:null,parent:s,prev:null,teardown:null,transitions:null,wv:0};if(r)try{vr(n),n.f|=fa}catch(u){throw Ae(n),u}else t!==null&&Bt(n);var o=r&&n.deps===null&&n.first===null&&n.nodes_start===null&&n.teardown===null&&(n.f&(Or|Ct))===0;if(!o&&a&&(s!==null&&Ha(n,s),B!==null&&(B.f&Te)!==0)){var v=B;(v.effects??(v.effects=[])).push(n)}return n}function Hr(e){const t=it(Ft,null,!1);return ke(t,pe),t.teardown=e,t}function Ne(e){La();var t=J!==null&&(J.f&Ie)!==0&&ge!==null&&!ge.m;if(t){var r=ge;(r.e??(r.e=[])).push({fn:e,effect:J,reaction:B})}else{var a=or(e);return a}}function qa(e){const t=it(st,e,!0);return(r={})=>new Promise(a=>{r.outro?St(t,()=>{Ae(t),a(void 0)}):(Ae(t),a(void 0))})}function or(e){return it(jr,e,!1)}function qr(e){return it(Ft,e,!0)}function ne(e,t=[],r=Wt){const a=t.map(r);return Ht(()=>e(...a.map(i)))}function Ht(e,t=0){return it(Ft|ar|t,e,!0)}function nt(e,t=!0){return it(Ft|Ie,e,!0,t)}function Br(e){var t=e.teardown;if(t!==null){const r=ht,a=B;wr(!0),Oe(null);try{t.call(null)}finally{wr(r),Oe(a)}}}function Jr(e,t=!1){var r=e.first;for(e.first=e.last=null;r!==null;){var a=r.next;(r.f&st)!==0?r.parent=null:Ae(r,t),r=a}}function Ba(e){for(var t=e.first;t!==null;){var r=t.next;(t.f&Ie)===0&&Ae(t),t=r}}function Ae(e,t=!0){var r=!1;(t||(e.f&_a)!==0)&&e.nodes_start!==null&&(Yr(e.nodes_start,e.nodes_end),r=!0),Jr(e,t&&!r),Nt(e,0),ke(e,Rt);var a=e.transitions;if(a!==null)for(const n of a)n.stop();Br(e);var s=e.parent;s!==null&&s.first!==null&&Ur(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function Yr(e,t){for(;e!==null;){var r=e===t?null:Lt(e);e.remove(),e=r}}function Ur(e){var t=e.parent,r=e.prev,a=e.next;r!==null&&(r.next=a),a!==null&&(a.prev=r),t!==null&&(t.first===e&&(t.first=a),t.last===e&&(t.last=r))}function St(e,t){var r=[];cr(e,r,!0),Vr(r,()=>{Ae(e),t&&t()})}function Vr(e,t){var r=e.length;if(r>0){var a=()=>--r||t();for(var s of e)s.out(a)}else t()}function cr(e,t,r){if((e.f&Pe)===0){if(e.f^=Pe,e.transitions!==null)for(const o of e.transitions)(o.is_global||r)&&t.push(o);for(var a=e.first;a!==null;){var s=a.next,n=(a.f&Mt)!==0||(a.f&Ie)!==0;cr(a,t,n?r:!1),a=s}}}function jt(e){Gr(e,!0)}function Gr(e,t){if((e.f&Pe)!==0){e.f^=Pe,(e.f&pe)===0&&(e.f^=pe),pt(e)&&(ke(e,je),Bt(e));for(var r=e.first;r!==null;){var a=r.next,s=(r.f&Mt)!==0||(r.f&Ie)!==0;Gr(r,s?t:!1),r=a}if(e.transitions!==null)for(const n of e.transitions)(n.is_global||t)&&n.in()}}let Ot=[];function Ja(){var e=Ot;Ot=[],da(e)}function ur(e){Ot.length===0&&queueMicrotask(Ja),Ot.push(e)}let xt=!1,Xt=!1,Dt=null,Ge=!1,ht=!1;function wr(e){ht=e}let Et=[];let B=null,Se=!1;function Oe(e){B=e}let J=null;function Le(e){J=e}let ve=null;function Kr(e){B!==null&&B.f&Kt&&(ve===null?ve=[e]:ve.push(e))}let ce=null,we=0,xe=null;function Ya(e){xe=e}let Zr=1,Pt=0,Me=!1;function Xr(){return++Zr}function pt(e){var h;var t=e.f;if((t&je)!==0)return!0;if((t&Ke)!==0){var r=e.deps,a=(t&be)!==0;if(r!==null){var s,n,o=(t&Tt)!==0,v=a&&J!==null&&!Me,u=r.length;if(o||v){var c=e,f=c.parent;for(s=0;s<u;s++)n=r[s],(o||!((h=n==null?void 0:n.reactions)!=null&&h.includes(c)))&&(n.reactions??(n.reactions=[])).push(c);o&&(c.f^=Tt),v&&f!==null&&(f.f&be)===0&&(c.f^=be)}for(s=0;s<u;s++)if(n=r[s],pt(n)&&$r(n),n.wv>e.wv)return!0}(!a||J!==null&&!Me)&&ke(e,pe)}return!1}function Ua(e,t){for(var r=t;r!==null;){if((r.f&Ct)!==0)try{r.fn(e);return}catch{r.f^=Ct}r=r.parent}throw xt=!1,e}function br(e){return(e.f&Rt)===0&&(e.parent===null||(e.parent.f&Ct)===0)}function qt(e,t,r,a){if(xt){if(r===null&&(xt=!1),br(t))throw e;return}if(r!==null&&(xt=!0),Ua(e,t),br(t))throw e}function Qr(e,t,r=!0){var a=e.reactions;if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];ve!=null&&ve.includes(e)||((n.f&Te)!==0?Qr(n,t,!1):t===n&&(r?ke(n,je):(n.f&pe)!==0&&ke(n,Ke),Bt(n)))}}function ea(e){var p;var t=ce,r=we,a=xe,s=B,n=Me,o=ve,v=ge,u=Se,c=e.f;ce=null,we=0,xe=null,Me=(c&be)!==0&&(Se||!Ge||B===null),B=(c&(Ie|st))===0?e:null,ve=null,hr(e.ctx),Se=!1,Pt++,e.f|=Kt;try{var f=(0,e.fn)(),h=e.deps;if(ce!==null){var l;if(Nt(e,we),h!==null&&we>0)for(h.length=we+ce.length,l=0;l<ce.length;l++)h[we+l]=ce[l];else e.deps=h=ce;if(!Me)for(l=we;l<h.length;l++)((p=h[l]).reactions??(p.reactions=[])).push(e)}else h!==null&&we<h.length&&(Nt(e,we),h.length=we);if(Nr()&&xe!==null&&!Se&&h!==null&&(e.f&(Te|Ke|je))===0)for(l=0;l<xe.length;l++)Qr(xe[l],e);return s!==null&&s!==e&&(Pt++,xe!==null&&(a===null?a=xe:a.push(...xe))),f}finally{ce=t,we=r,xe=a,B=s,Me=n,ve=o,hr(v),Se=u,e.f^=Kt}}function Va(e,t){let r=t.reactions;if(r!==null){var a=ia.call(r,e);if(a!==-1){var s=r.length-1;s===0?r=t.reactions=null:(r[a]=r[s],r.pop())}}r===null&&(t.f&Te)!==0&&(ce===null||!ce.includes(t))&&(ke(t,Ke),(t.f&(be|Tt))===0&&(t.f^=Tt),Ar(t),Nt(t,0))}function Nt(e,t){var r=e.deps;if(r!==null)for(var a=t;a<r.length;a++)Va(e,r[a])}function vr(e){var t=e.f;if((t&Rt)===0){ke(e,pe);var r=J,a=ge,s=Ge;J=e,Ge=!0;try{(t&ar)!==0?Ba(e):Jr(e),Br(e);var n=ea(e);e.teardown=typeof n=="function"?n:null,e.wv=Zr;var o=e.deps,v;fr&&ka&&e.f&je}catch(u){qt(u,e,r,a||e.ctx)}finally{Ge=s,J=r}}}function Ga(){try{ya()}catch(e){if(Dt!==null)qt(e,Dt,null);else throw e}}function Ka(){var e=Ge;try{var t=0;for(Ge=!0;Et.length>0;){t++>1e3&&Ga();var r=Et,a=r.length;Et=[];for(var s=0;s<a;s++){var n=Xa(r[s]);Za(n)}ft.clear()}}finally{Xt=!1,Ge=e,Dt=null}}function Za(e){var t=e.length;if(t!==0)for(var r=0;r<t;r++){var a=e[r];if((a.f&(Rt|Pe))===0)try{pt(a)&&(vr(a),a.deps===null&&a.first===null&&a.nodes_start===null&&(a.teardown===null?Ur(a):a.fn=null))}catch(s){qt(s,a,null,a.ctx)}}}function Bt(e){Xt||(Xt=!0,queueMicrotask(Ka));for(var t=Dt=e;t.parent!==null;){t=t.parent;var r=t.f;if((r&(st|Ie))!==0){if((r&pe)===0)return;t.f^=pe}}Et.push(t)}function Xa(e){for(var t=[],r=e;r!==null;){var a=r.f,s=(a&(Ie|st))!==0,n=s&&(a&pe)!==0;if(!n&&(a&Pe)===0){if((a&jr)!==0)t.push(r);else if(s)r.f^=pe;else try{pt(r)&&vr(r)}catch(u){qt(u,r,null,r.ctx)}var o=r.first;if(o!==null){r=o;continue}}var v=r.parent;for(r=r.next;r===null&&v!==null;)r=v.next,v=v.parent}return t}function i(e){var t=e.f,r=(t&Te)!==0;if(B!==null&&!Se){if(!(ve!=null&&ve.includes(e))){var a=B.deps;e.rv<Pt&&(e.rv=Pt,ce===null&&a!==null&&a[we]===e?we++:ce===null?ce=[e]:(!Me||!ce.includes(e))&&ce.push(e))}}else if(r&&e.deps===null&&e.effects===null){var s=e,n=s.parent;n!==null&&(n.f&be)===0&&(s.f^=be)}return r&&(s=e,pt(s)&&$r(s)),ht&&ft.has(e)?ft.get(e):e.v}function At(e){var t=Se;try{return Se=!0,e()}finally{Se=t}}const Qa=-7169;function ke(e,t){e.f=e.f&Qa|t}const en=["touchstart","touchmove"];function tn(e){return en.includes(e)}let gr=!1;function rn(){gr||(gr=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const r of e.target.elements)(t=r.__on_r)==null||t.call(r)})},{capture:!0}))}function ta(e){var t=B,r=J;Oe(null),Le(null);try{return e()}finally{Oe(t),Le(r)}}function an(e,t,r,a=r){e.addEventListener(t,()=>ta(r));const s=e.__on_r;s?e.__on_r=()=>{s(),a(!0)}:e.__on_r=()=>a(!0),rn()}const ra=new Set,Qt=new Set;function nn(e,t,r,a={}){function s(n){if(a.capture||vt.call(t,n),!n.cancelBubble)return ta(()=>r==null?void 0:r.call(this,n))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?ur(()=>{t.addEventListener(e,s,a)}):t.addEventListener(e,s,a),s}function dr(e,t,r,a,s){var n={capture:a,passive:s},o=nn(e,t,r,n);(t===document.body||t===window||t===document)&&Hr(()=>{t.removeEventListener(e,o,n)})}function Ze(e){for(var t=0;t<e.length;t++)ra.add(e[t]);for(var r of Qt)r(e)}function vt(e){var T;var t=this,r=t.ownerDocument,a=e.type,s=((T=e.composedPath)==null?void 0:T.call(e))||[],n=s[0]||e.target,o=0,v=e.__root;if(v){var u=s.indexOf(v);if(u!==-1&&(t===document||t===window)){e.__root=t;return}var c=s.indexOf(t);if(c===-1)return;u<=c&&(o=u)}if(n=s[o]||e.target,n!==t){la(e,"currentTarget",{configurable:!0,get(){return n||r}});var f=B,h=J;Oe(null),Le(null);try{for(var l,p=[];n!==null;){var b=n.assignedSlot||n.parentNode||n.host||null;try{var m=n["__"+a];if(m!=null&&(!n.disabled||e.target===n))if(tr(m)){var[E,...C]=m;E.apply(n,[e,...C])}else m.call(n,e)}catch(z){l?p.push(z):l=z}if(e.cancelBubble||b===t||b===null)break;n=b}if(l){for(let z of p)queueMicrotask(()=>{throw z});throw l}}finally{e.__root=t,delete e.currentTarget,Oe(f),Le(h)}}}function aa(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function It(e,t){var r=J;r.nodes_start===null&&(r.nodes_start=e,r.nodes_end=t)}function D(e,t){var r=(t&Na)!==0,a=(t&Aa)!==0,s,n=!e.startsWith("<!>");return()=>{s===void 0&&(s=aa(n?e:"<!>"+e),r||(s=Re(s)));var o=a||Mr?document.importNode(s,!0):s.cloneNode(!0);if(r){var v=Re(o),u=o.lastChild;It(v,u)}else It(o,o);return o}}function mr(){var e=document.createDocumentFragment(),t=document.createComment(""),r=lr();return e.append(t,r),It(t,r),e}function S(e,t){e!==null&&e.before(t)}function ue(e,t){var r=t==null?"":typeof t=="object"?t+"":t;r!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=r,e.nodeValue=r+"")}function sn(e,t){return ln(e,t)}const tt=new Map;function ln(e,{target:t,anchor:r,props:a={},events:s,context:n,intro:o=!0}){Ma();var v=new Set,u=h=>{for(var l=0;l<h.length;l++){var p=h[l];if(!v.has(p)){v.add(p);var b=tn(p);t.addEventListener(p,vt,{passive:b});var m=tt.get(p);m===void 0?(document.addEventListener(p,vt,{passive:b}),tt.set(p,1)):tt.set(p,m+1)}}};u(rr(ra)),Qt.add(u);var c=void 0,f=qa(()=>{var h=r??t.appendChild(lr());return nt(()=>{if(n){He({});var l=ge;l.c=n}s&&(a.$$events=s),c=e(h,a)||{},n&&qe()}),()=>{var b;for(var l of v){t.removeEventListener(l,vt);var p=tt.get(l);--p===0?(document.removeEventListener(l,vt),tt.delete(l)):tt.set(l,p)}Qt.delete(u),h!==r&&((b=h.parentNode)==null||b.removeChild(h))}});return on.set(c,f),c}let on=new WeakMap;function W(e,t,[r,a]=[0,0]){var s=e,n=null,o=null,v=fe,u=r>0?Mt:0,c=!1;const f=(l,p=!0)=>{c=!0,h(p,l)},h=(l,p)=>{v!==(v=l)&&(v?(n?jt(n):p&&(n=nt(()=>p(s))),o&&St(o,()=>{o=null})):(o?jt(o):p&&(o=nt(()=>p(s,[r+1,a]))),n&&St(n,()=>{n=null})))};Ht(()=>{c=!1,t(f),c||h(null,null)},u)}function na(e,t){return t}function cn(e,t,r,a){for(var s=[],n=t.length,o=0;o<n;o++)cr(t[o].e,s,!0);var v=n>0&&s.length===0&&r!==null;if(v){var u=r.parentNode;Wa(u),u.append(r),a.clear(),Fe(e,t[0].prev,t[n-1].next)}Vr(s,()=>{for(var c=0;c<n;c++){var f=t[c];v||(a.delete(f.k),Fe(e,f.prev,f.next)),Ae(f.e,!v)}})}function $t(e,t,r,a,s,n=null){var o=e,v={flags:t,items:new Map,first:null},u=(t&Pr)!==0;if(u){var c=e;o=c.appendChild(lr())}var f=null,h=!1,l=$a(()=>{var p=r();return tr(p)?p:p==null?[]:rr(p)});Ht(()=>{var p=i(l),b=p.length;h&&b===0||(h=b===0,un(p,v,o,s,t,a,r),n!==null&&(b===0?f?jt(f):f=nt(()=>n(o)):f!==null&&St(f,()=>{f=null})),i(l))})}function un(e,t,r,a,s,n,o){var G,ie,A,R;var v=(s&za)!==0,u=(s&(sr|ir))!==0,c=e.length,f=t.items,h=t.first,l=h,p,b=null,m,E=[],C=[],T,z,g,y;if(v)for(y=0;y<c;y+=1)T=e[y],z=n(T,y),g=f.get(z),g!==void 0&&((G=g.a)==null||G.measure(),(m??(m=new Set)).add(g));for(y=0;y<c;y+=1){if(T=e[y],z=n(T,y),g=f.get(z),g===void 0){var M=l?l.e.nodes_start:r;b=dn(M,t,b,b===null?t.first:b.next,T,z,y,a,s,o),f.set(z,b),E=[],C=[],l=b.next;continue}if(u&&vn(g,T,y,s),(g.e.f&Pe)!==0&&(jt(g.e),v&&((ie=g.a)==null||ie.unfix(),(m??(m=new Set)).delete(g))),g!==l){if(p!==void 0&&p.has(g)){if(E.length<C.length){var L=C[0],q;b=L.prev;var P=E[0],I=E[E.length-1];for(q=0;q<E.length;q+=1)yr(E[q],L,r);for(q=0;q<C.length;q+=1)p.delete(C[q]);Fe(t,P.prev,I.next),Fe(t,b,P),Fe(t,I,L),l=L,b=I,y-=1,E=[],C=[]}else p.delete(g),yr(g,l,r),Fe(t,g.prev,g.next),Fe(t,g,b===null?t.first:b.next),Fe(t,b,g),b=g;continue}for(E=[],C=[];l!==null&&l.k!==z;)(l.e.f&Pe)===0&&(p??(p=new Set)).add(l),C.push(l),l=l.next;if(l===null)continue;g=l}E.push(g),b=g,l=g.next}if(l!==null||p!==void 0){for(var K=p===void 0?[]:rr(p);l!==null;)(l.e.f&Pe)===0&&K.push(l),l=l.next;var N=K.length;if(N>0){var j=(s&Pr)!==0&&c===0?r:null;if(v){for(y=0;y<N;y+=1)(A=K[y].a)==null||A.measure();for(y=0;y<N;y+=1)(R=K[y].a)==null||R.fix()}cn(t,K,j,f)}}v&&ur(()=>{var $;if(m!==void 0)for(g of m)($=g.a)==null||$.apply()}),J.first=t.first&&t.first.e,J.last=b&&b.e}function vn(e,t,r,a){(a&sr)!==0&&Zt(e.v,t),(a&ir)!==0?Zt(e.i,r):e.i=r}function dn(e,t,r,a,s,n,o,v,u,c){var f=(u&sr)!==0,h=(u&Sa)===0,l=f?h?Fr(s):zt(s):s,p=(u&ir)===0?o:zt(o),b={i:p,v:l,k:n,a:null,e:null,prev:r,next:a};try{return b.e=nt(()=>v(e,l,p,c),Ra),b.e.prev=r&&r.e,b.e.next=a&&a.e,r===null?t.first=b:(r.next=b,r.e.next=b.e),a!==null&&(a.prev=b,a.e.prev=b.e),b}finally{}}function yr(e,t,r){for(var a=e.next?e.next.e.nodes_start:r,s=t?t.e.nodes_start:r,n=e.e.nodes_start;n!==a;){var o=Lt(n);s.before(n),n=o}}function Fe(e,t,r){t===null?e.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function _t(e,t,r=!1,a=!1,s=!1){var n=e,o="";ne(()=>{var v=J;if(o!==(o=t()??"")&&(v.nodes_start!==null&&(Yr(v.nodes_start,v.nodes_end),v.nodes_start=v.nodes_end=null),o!=="")){var u=o+"";r?u=`<svg>${u}</svg>`:a&&(u=`<math>${u}</math>`);var c=aa(u);if((r||a)&&(c=Re(c)),It(Re(c),c.lastChild),r||a)for(;Re(c);)n.before(Re(c));else n.before(c)}})}function xr(e,t,...r){var a=e,s=va,n;Ht(()=>{s!==(s=t())&&(n&&(Ae(n),n=null),n=nt(()=>s(a,...r)))},Mt)}const Er=[...` 	
\r\f \v\uFEFF`];function fn(e,t,r){var a=e==null?"":""+e;if(t&&(a=a?a+" "+t:t),r){for(var s in r)if(r[s])a=a?a+" "+s:s;else if(a.length)for(var n=s.length,o=0;(o=a.indexOf(s,o))>=0;){var v=o+n;(o===0||Er.includes(a[o-1]))&&(v===a.length||Er.includes(a[v]))?a=(o===0?"":a.substring(0,o))+a.substring(v+1):o=v}}return a===""?null:a}function he(e,t,r,a,s,n){var o=e.__className;if(o!==r||o===void 0){var v=fn(r,a,n);v==null?e.removeAttribute("class"):e.className=v,e.__className=r}else if(n&&s!==n)for(var u in n){var c=!!n[u];(s==null||c!==!!s[u])&&e.classList.toggle(u,c)}return n}const _n=Symbol("is custom element"),hn=Symbol("is html");function er(e,t,r,a){var s=pn(e);s[t]!==(s[t]=r)&&(t==="loading"&&(e[pa]=r),r==null?e.removeAttribute(t):typeof r!="string"&&wn(e).includes(t)?e[t]=r:e.setAttribute(t,r))}function pn(e){return e.__attributes??(e.__attributes={[_n]:e.nodeName.includes("-"),[hn]:e.namespaceURI===Ia})}var Cr=new Map;function wn(e){var t=Cr.get(e.nodeName);if(t)return t;Cr.set(e.nodeName,t=[]);for(var r,a=e,s=Element.prototype;s!==a;){r=oa(a);for(var n in r)r[n].set&&t.push(n);a=Sr(a)}return t}function We(e,t,r=t){an(e,"input",a=>{var s=a?e.defaultValue:e.value;if(s=Vt(e)?Gt(s):s,r(s),s!==(s=t())){var n=e.selectionStart,o=e.selectionEnd;e.value=s??"",o!==null&&(e.selectionStart=n,e.selectionEnd=Math.min(o,e.value.length))}}),At(t)==null&&e.value&&r(Vt(e)?Gt(e.value):e.value),qr(()=>{var a=t();Vt(e)&&a===Gt(e.value)||e.type==="date"&&!a&&!e.value||a!==e.value&&(e.value=a??"")})}function Vt(e){var t=e.type;return t==="number"||t==="range"}function Gt(e){return e===""?null:+e}function Tr(e,t){return e===t||(e==null?void 0:e[dt])===t}function Jt(e={},t,r,a){return or(()=>{var s,n;return qr(()=>{s=n,n=[],At(()=>{e!==r(...n)&&(t(e,...n),s&&Tr(r(...s),e)&&t(null,...s))})}),()=>{ur(()=>{n&&Tr(r(...n),e)&&t(null,...n)})}}),e}let yt=!1;function bn(e){var t=yt;try{return yt=!1,[e(),yt]}finally{yt=t}}function kr(e){var t;return((t=e.ctx)==null?void 0:t.d)??!1}function Ve(e,t,r,a){var y;var s=(r&ja)!==0,n=!0,o=(r&Da)!==0,v=(r&Pa)!==0,u=!1,c;o?[c,u]=bn(()=>e[t]):c=e[t];var f=dt in e||ha in e,h=o&&(((y=rt(e,t))==null?void 0:y.set)??(f&&t in e&&(M=>e[t]=M)))||void 0,l=a,p=!0,b=!1,m=()=>(b=!0,p&&(p=!1,v?l=At(a):l=a),l);c===void 0&&a!==void 0&&(h&&n&&xa(),c=m(),h&&h(c));var E;if(E=()=>{var M=e[t];return M===void 0?m():(p=!0,b=!1,M)},(r&Oa)===0)return E;if(h){var C=e.$$legacy;return function(M,L){return arguments.length>0?((!L||C||u)&&h(L?E():M),M):E()}}var T=!1,z=Fr(c),g=Wt(()=>{var M=E(),L=i(z);return T?(T=!1,L):z.v=M});return o&&i(g),s||(g.equals=nr),function(M,L){if(arguments.length>0){const q=L?i(g):o?_e(M):M;if(!g.equals(q)){if(T=!0,d(z,q),b&&l!==void 0&&(l=q),kr(g))return M;At(()=>i(g))}return M}return kr(g)?g.v:i(g)}}const gn="5";var zr;typeof window<"u"&&((zr=window.__svelte??(window.__svelte={})).v??(zr.v=new Set)).add(gn);var mn=(e,t)=>t("/"),yn=(e,t)=>t("/world"),xn=(e,t)=>t("/characters"),En=(e,t)=>t("/outline"),Cn=(e,t)=>t("/chapters"),Tn=D("<nav><ul><li><button>Home</button></li> <li><button>World</button></li> <li><button>Characters</button></li> <li><button>Outline</button></li> <li><button>Chapters</button></li></ul></nav>");function kn(e,t){He(t,!0);function r(g){history.pushState({},"",g),window.dispatchEvent(new PopStateEvent("popstate"))}var a=Tn(),s=_(a),n=_(s);let o;var v=_(n);v.__click=[mn,r];var u=w(n,2);let c;var f=_(u);f.__click=[yn,r];var h=w(u,2);let l;var p=_(h);p.__click=[xn,r];var b=w(h,2);let m;var E=_(b);E.__click=[En,r];var C=w(b,2);let T;var z=_(C);z.__click=[Cn,r],ne((g,y,M,L,q)=>{o=he(n,1,"",null,o,g),c=he(u,1,"",null,c,y),l=he(h,1,"",null,l,M),m=he(b,1,"",null,m,L),T=he(C,1,"",null,T,q)},[()=>({active:t.currentPath==="/"}),()=>({active:t.currentPath==="/world"}),()=>({active:t.currentPath==="/characters"}),()=>({active:t.currentPath==="/outline"}),()=>({active:t.currentPath==="/chapters"})]),S(e,a),qe()}Ze(["click"]);var zn=(e,t)=>t("/world"),Sn=(e,t)=>t("/characters"),jn=(e,t)=>t("/outline"),On=(e,t)=>t("/chapters"),Dn=D(`<div class="home-container svelte-4rwz0y"><header class="welcome-header svelte-4rwz0y"><h1>Welcome to hypeWriter</h1> <p class="tagline svelte-4rwz0y">Create your book with AI assistance</p></header> <section class="progress-overview"><h2 class="svelte-4rwz0y">Your Writing Journey</h2> <div class="progress-steps svelte-4rwz0y"><div><span class="step-number svelte-4rwz0y">1</span> <h3 class="svelte-4rwz0y">World Building</h3> <p>Create your story's universe</p> <button class="action-button svelte-4rwz0y"> </button></div> <div><span class="step-number svelte-4rwz0y">2</span> <h3 class="svelte-4rwz0y">Characters</h3> <p>Develop your cast</p> <button class="action-button svelte-4rwz0y"> </button></div> <div><span class="step-number svelte-4rwz0y">3</span> <h3 class="svelte-4rwz0y">Outline</h3> <p>Structure your story</p> <button class="action-button svelte-4rwz0y"> </button></div> <div><span class="step-number svelte-4rwz0y">4</span> <h3 class="svelte-4rwz0y">Chapters</h3> <p>Write your story</p> <button class="action-button svelte-4rwz0y"> </button></div></div></section> <section class="info-box svelte-4rwz0y"><h2 class="svelte-4rwz0y">About This Tool</h2> <p>hypeWriter is an open-source tool that uses AI to help you write your book. All content is
			generated locally on your computer and saved in the <code class="svelte-4rwz0y">book_output</code> folder. You can edit, modify, and export your book at any time.</p></section></div>`);function Pn(e,t){He(t,!0);let r=k(_e({hasWorld:!1,hasCharacters:!1,hasOutline:!1,chapterCount:0}));Ne(async()=>{try{const q=await(await fetch("/api/project-status")).json();d(r,q,!0)}catch(L){console.error("Failed to fetch project status:",L)}});function a(L){history.pushState(null,"",L),window.dispatchEvent(new PopStateEvent("popstate"))}var s=Dn(),n=w(_(s),2),o=w(_(n),2),v=_(o);let u;var c=w(_(v),6);c.__click=[zn,a];var f=_(c),h=w(v,2);let l;var p=w(_(h),6);p.__click=[Sn,a];var b=_(p),m=w(h,2);let E;var C=w(_(m),6);C.__click=[jn,a];var T=_(C),z=w(m,2);let g;var y=w(_(z),6);y.__click=[On,a];var M=_(y);ne((L,q,P,I)=>{u=he(v,1,"step svelte-4rwz0y",null,u,L),ue(f,i(r).hasWorld?"Edit World":"Start World Building"),l=he(h,1,"step svelte-4rwz0y",null,l,q),p.disabled=!i(r).hasWorld,ue(b,i(r).hasCharacters?"Edit Characters":"Create Characters"),E=he(m,1,"step svelte-4rwz0y",null,E,P),C.disabled=!i(r).hasCharacters,ue(T,i(r).hasOutline?"Edit Outline":"Create Outline"),g=he(z,1,"step svelte-4rwz0y",null,g,I),y.disabled=!i(r).hasOutline,ue(M,i(r).chapterCount>0?"Continue Writing":"Start Writing")},[()=>({completed:i(r).hasWorld}),()=>({completed:i(r).hasCharacters}),()=>({completed:i(r).hasOutline}),()=>({completed:i(r).chapterCount>0})]),S(e,s),qe()}Ze(["click"]);var Nn=D('<div><div class="content svelte-1ur1bpy"><!></div></div>'),An=D('<div class="typing-indicator svelte-1ur1bpy"><div class="spinner svelte-1ur1bpy"></div> <span class="svelte-1ur1bpy">AI is thinking...</span></div>'),In=(e,t)=>e.key==="Enter"&&!e.shiftKey&&t(),$n=D('<div class="chat-container svelte-1ur1bpy"><!> <div id="chatMessages" class="chat-messages-area p-3 mb-3 border rounded svelte-1ur1bpy"><!> <!></div> <div class="input-container d-flex svelte-1ur1bpy"><textarea class="form-control me-2 svelte-1ur1bpy"></textarea> <button class="send-button btn btn-primary svelte-1ur1bpy"> </button></div> <div class="mt-3 text-center svelte-1ur1bpy"><!></div></div>');function Fn(e,t){He(t,!0);let r=Ve(t,"chatHistory",15),a=Ve(t,"contextData",19,()=>({})),s=Ve(t,"placeholderText",3,"Type your message..."),n=Ve(t,"isGenerating",15,!1),o=Ve(t,"topic",15,""),v=k(""),u;Ne(()=>{u&&(u.scrollTop=u.scrollHeight)});async function c(){const P=i(v).trim();if(!P||n())return;d(v,""),n(!0),r([...r(),{role:"user",content:P}]),!o()&&r().filter(j=>j.role==="user").length===1&&(o(P.split(" ").slice(0,5).join(" ")),console.log("Derived topic:",o()));let I=r().length;r([...r(),{role:"assistant",content:'<span class="typing-cursor">▌</span>'}]),r([...r()]);const K={message:P,chat_history:r().slice(0,I),...a(),topic:o()};let N="";try{const j=await fetch(t.chatEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(K)});if(!j.ok||!j.body){const A=await j.json().catch(()=>({detail:"Unknown error"}));throw new Error(`Chat stream request failed: ${j.status} ${j.statusText} - ${A.detail}`)}const G=j.body.getReader(),ie=new TextDecoder;for(r()[I]?(r(r()[I].content="",!0),r([...r()])):(r([...r(),{role:"assistant",content:""}]),I=r().length-1,r([...r()]));;){const{done:A,value:R}=await G.read();if(A)break;ie.decode(R).split(`

`).filter(Boolean).forEach(Z=>{if(Z.startsWith("data: "))try{const re=Z.substring(6);if(re==="[DONE]")return;const U=JSON.parse(re);U.content!==void 0&&(N+=U.content,r()[I]&&(r(r()[I].content=f(N)+'<span class="typing-cursor">▌</span>',!0),r([...r()])))}catch(re){console.error("Error parsing SSE data line:",re,jsonData),r()[I]&&(r(r()[I].content=f(N)+` [Parsing Error: ${re.message}]<span class="typing-cursor">▌</span>`,!0),r([...r()]))}})}r()[I]&&(r(r()[I].content=f(N),!0),r([...r()]))}catch(j){console.error("Chat stream fetch error:",j),r()[I]?(r(r()[I].content=f(N)+` [Error: ${j.message}]`,!0),r([...r()])):(r([...r(),{role:"system",content:`Error communicating with AI: ${j.message}. Please check the console.`}]),r([...r()]))}finally{n(!1)}}function f(P){return P.replace(/\n{2,}/g,"<br><br>").replace(/\n/g,"<br>")}var h=$n(),l=_(h);{var p=P=>{var I=mr(),K=at(I);xr(K,()=>t.introText),S(P,I)};W(l,P=>{t.introText&&P(p)})}var b=w(l,2),m=_(b);$t(m,17,r,na,(P,I)=>{var K=Nn(),N=_(K),j=_(N);_t(j,()=>f(i(I).content)),ne(()=>he(K,1,`message ${i(I).role??""}`,"svelte-1ur1bpy")),S(P,K)});var E=w(m,2);{var C=P=>{var I=An();S(P,I)};W(E,P=>{n()&&P(C)})}Jt(b,P=>u=P,()=>u);var T=w(b,2),z=_(T);z.__keydown=[In,c];var g=w(z,2);g.__click=c;var y=_(g),M=w(T,2),L=_(M);{var q=P=>{var I=mr(),K=at(I);xr(K,()=>t.belowInput),S(P,I)};W(L,P=>{t.belowInput&&P(q)})}ne(P=>{er(z,"placeholder",s()),z.disabled=n(),g.disabled=P,ue(y,n()?"...":"Send")},[()=>n()||!i(v).trim()]),We(z,()=>i(v),P=>d(v,P)),S(e,h),qe()}Ze(["keydown","click"]);var Rn=(e,t)=>t("/characters"),Mn=D("<p>Current Topic: <strong> </strong></p>"),Wn=D('<div class="alert alert-danger mt-3" role="alert"> </div>'),Ln=D('<div class="col-12 mb-4"><div class="alert alert-info d-flex align-items-center" role="status"><div class="spinner-border spinner-border-sm me-2" aria-hidden="true"></div> Loading world data...</div></div>'),Hn=D('<div class="alert alert-info mt-3"><div class="d-flex align-items-center"><div class="spinner-border spinner-border-sm me-2" role="status"><span class="visually-hidden">Loading...</span></div> <div>AI is thinking...</div></div></div>'),qn=D('<button class="btn btn-success mt-3 svelte-1sia47x">Finalize World Setting</button> <!>',1),Bn=D('<div class="col-12 mb-4"><div class="card svelte-1sia47x"><div class="card-header bg-primary text-white"><h2 class="h5 mb-0">World Building Chat</h2></div> <div class="card-body"><!></div></div></div>'),Jn=(e,t)=>t("/characters"),Yn=D('<div class="alert alert-info mt-3"><div class="d-flex align-items-center"><div class="spinner-border spinner-border-sm me-2" role="status"><span class="visually-hidden">Saving...</span></div> <div>Saving changes...</div></div></div>'),Un=D('<div class="alert alert-success mt-3"><div>World setting saved successfully!</div></div>'),Vn=D('<div class="alert alert-danger mt-3" role="alert"> </div>'),Gn=D('<div class="col-12"><div class="card svelte-1sia47x"><div class="card-header bg-success text-white"><h2 class="h5 mb-0">Your World Setting</h2></div> <div class="card-body"><form><div class="mb-3"><label for="worldTheme" class="form-label">Edit your world setting if needed:</label> <textarea class="form-control" id="worldTheme" name="world_theme" rows="12"></textarea></div> <div class="d-flex justify-content-between"><button type="submit" class="btn btn-success svelte-1sia47x">Save Changes</button> <button class="btn btn-primary svelte-1sia47x">Continue to Characters</button></div></form> <!> <!> <!></div></div></div>'),Kn=D(`<div class="world-container svelte-1sia47x"><div class="row"><div class="col-12 mb-4"><div class="card svelte-1sia47x"><div class="card-header bg-primary text-white d-flex justify-content-between align-items-center"><h1 class="h4 mb-0">Create World Setting</h1> <button class="btn btn-light btn-sm svelte-1sia47x">Next: Characters &raquo;</button></div> <div class="card-body svelte-1sia47x"><p class="lead svelte-1sia47x">Start by chatting with the AI to develop your book's world. Describe your ideas, answer
						questions, and explore different aspects of your world together.</p> <!> <!></div></div></div> <!> <!> <!></div></div>`);function Zn(e,t){He(t,!0);let r=Ve(t,"initial_world_theme",3,""),a=Ve(t,"initial_topic",3,""),s=k(_e([])),n=k(""),o=k(_e(a()||"")),v=k(!0),u=k(null),c=k(!1),f=k(!1),h=k(null),l=k(!0),p=k(!1),b=kt(()=>i(s).filter(x=>x.role==="user").length===0||i(v)||i(p)),m=kt(()=>!i(v)&&i(n).length>0),E;const C="Tell me about the world you want to create for your book. What kind of setting, time period, or genre are you interested in?";Ne(()=>{async function x(){d(v,!0),d(u,null),d(l,!0);try{const O=await fetch("/api/world");if(!O.ok){const se=await O.text();throw new Error(`HTTP error! status: ${O.status}: ${se}`)}const F=await O.json();d(n,F.world_theme||r(),!0),d(o,F.topic||a(),!0),i(n)?d(s,[{role:"system",content:"Loaded existing World Setting:"},{role:"assistant",content:i(n)}],!0):d(s,[{role:"assistant",content:C}],!0)}catch(O){console.error("Error loading initial world data:",O),d(u,`Failed to load initial data: ${O.message}`),d(n,r()),d(o,a()),d(s,[{role:"system",content:`Error loading previous world data: ${O.message}`},{role:"assistant",content:C}],!0)}finally{d(v,!1),d(l,!i(m))}}x()}),Ne(()=>{!i(c)&&!i(v)&&i(m)?d(l,!1):i(m)||d(l,!0)});async function T(){if(i(s).filter(F=>F.role==="user").length===0){alert("Please send at least one message to the AI before finalizing.");return}if(i(b))return;d(n,"");const x={chat_history:i(s),topic:i(o)};let O="";try{const F=await fetch("/finalize_world_stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!F.ok||!F.body){const X=await F.text();throw new Error(`HTTP error! status: ${F.status}: ${X}`)}const se=F.body.getReader(),H=new TextDecoder;for(;;){const{value:X,done:de}=await se.read();if(de)break;H.decode(X).split(`

`).filter(Boolean).forEach(oe=>{if(oe.startsWith("data: "))try{const ae=oe.substring(6);if(ae==="[DONE]")return;const le=JSON.parse(ae);le.content!==void 0&&(O+=le.content,d(n,O,!0))}catch(ae){console.error("Error parsing JSON from finalize stream:",ae,jsonData),d(n,i(n)+` [Parsing Error: ${ae.message}]`)}})}}catch(F){console.error("Fetch error for final world setting:",F),d(n,`Error finalizing world setting: ${F.message}

`+i(n))}finally{d(p,!1)}}async function z(x){if(x.preventDefault(),i(l))return;d(c,!0),d(f,!1),d(h,null),d(l,!0);const O={world_theme:i(n)};try{const F=await fetch("/save_world",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)});if(!F.ok){const se=await F.text();throw new Error(`HTTP error! status: ${F.status}: ${se}`)}d(c,!1),d(f,!0),setTimeout(()=>{d(f,!1)},3e3)}catch(F){console.error("Error saving world theme:",F),d(h,`Error saving world theme: ${F.message}`),d(c,!1),d(l,!1)}}function g(x){history.pushState(null,"",x),window.dispatchEvent(new PopStateEvent("popstate"))}var y=Kn(),M=_(y),L=_(M),q=_(L),P=_(q),I=w(_(P),2);I.__click=[Rn,g];var K=w(P,2),N=w(_(K),2);{var j=x=>{var O=Mn(),F=w(_(O)),se=_(F);ne(()=>ue(se,i(o))),S(x,O)};W(N,x=>{i(o)&&x(j)})}var G=w(N,2);{var ie=x=>{var O=Wn(),F=_(O);ne(()=>ue(F,i(u))),S(x,O)};W(G,x=>{i(u)&&x(ie)})}var A=w(L,2);{var R=x=>{var O=Ln();S(x,O)};W(A,x=>{i(v)&&x(R)})}var $=w(A,2);{var Z=x=>{var O=Bn(),F=_(O),se=w(_(F),2),H=_(se);Fn(H,{chatEndpoint:"/world_chat_stream",contextData:{},placeholderText:"Type your ideas about the world you want to create...",get chatHistory(){return i(s)},set chatHistory(Q){d(s,Q,!0)},get isGenerating(){return i(p)},set isGenerating(Q){d(p,Q,!0)},get topic(){return i(o)},set topic(Q){d(o,Q,!0)},introText:Q=>{},belowInput:Q=>{var oe=qn(),ae=at(oe);ae.__click=T;var le=w(ae,2);{var ze=Ee=>{var Be=Hn();S(Ee,Be)};W(le,Ee=>{i(p)&&Ee(ze)})}ne(()=>ae.disabled=i(b)),S(Q,oe)},$$slots:{introText:!0,belowInput:!0}}),S(x,O)};W($,x=>{!i(m)&&!i(v)&&x(Z)})}var re=w($,2);{var U=x=>{var O=Gn(),F=_(O),se=w(_(F),2),H=_(se),X=_(H),de=w(_(X),2);Jt(de,ee=>E=ee,()=>E);var Q=w(X,2),oe=_(Q),ae=w(oe,2);ae.__click=[Jn,g];var le=w(H,2);{var ze=ee=>{var te=Yn();S(ee,te)};W(le,ee=>{i(c)&&ee(ze)})}var Ee=w(le,2);{var Be=ee=>{var te=Un();S(ee,te)};W(Ee,ee=>{i(f)&&ee(Be)})}var lt=w(Ee,2);{var ot=ee=>{var te=Vn(),me=_(te);ne(()=>ue(me,i(h))),S(ee,te)};W(lt,ee=>{i(h)&&ee(ot)})}ne(()=>{oe.disabled=i(l),ae.disabled=!i(n)||i(c)||i(v)}),dr("submit",H,z),We(de,()=>i(n),ee=>d(n,ee)),S(x,O)};W(re,x=>{i(m)&&x(U)})}ne(()=>I.disabled=!i(n)||i(c)||i(v)),S(e,y),qe()}Ze(["click"]);async function Xn(e,t,r,a,s,n,o,v,u){if(i(t).filter(f=>f.role==="user").length===0){alert("Please send at least one message to the AI before finalizing.");return}if(i(r))return;d(a,!0),d(s,""),d(n,"");const c={chat_history:i(t),world_theme:i(o),num_characters:i(v)};try{const f=await fetch("/finalize_characters_stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!f.ok||!f.body){const b=await f.text();throw new Error(`HTTP error! status: ${f.status}: ${b}`)}const h=f.body.getReader(),l=new TextDecoder;let p="";for(;;){const{value:b,done:m}=await h.read();if(m)break;l.decode(b).split(`

`).filter(Boolean).forEach(C=>{if(C.startsWith("data: "))try{const T=C.substring(6);if(T==="[DONE]")return;const z=JSON.parse(T);z.content!==void 0&&(p+=z.content,d(n,p,!0))}catch(T){console.error("Error parsing JSON from finalize stream:",T,jsonData),d(n,i(n)+` [Parsing Error: ${T.message}]`)}})}d(u,!0)}catch(f){console.error("Fetch error for final characters:",f),d(n,`Error finalizing characters: ${f.message}

`+i(n)),d(u,!0)}finally{d(a,!1),d(s,"")}}async function Qn(e,t){const r={characters:i(t)};try{const a=await fetch("/save_characters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){const s=await a.text();throw new Error(`HTTP error! status: ${a.status}: ${s}`)}alert("Characters saved successfully!")}catch(a){console.error("Error saving characters:",a),alert(`Failed to save characters: ${a.message}`)}}var es=D('<a href="/outline" class="btn btn-light svelte-1dlxgbj">Next: Outline &raquo;</a>'),ts=D('<div class="col-12 mb-4 svelte-1dlxgbj"><div class="alert alert-warning svelte-1dlxgbj"><strong class="svelte-1dlxgbj">Context needed!</strong> Please ensure you have set your <a href="/world" class="alert-link svelte-1dlxgbj">World Setting</a> before developing characters.</div></div>'),rs=(e,t)=>d(t,!i(t)),as=D('<div class="full-world mt-2 pt-2 border-top svelte-1dlxgbj"><p class="svelte-1dlxgbj"> </p></div>'),ns=D('<div><div class="content svelte-1dlxgbj"><!></div></div>'),ss=D('<div class="message assistant svelte-1dlxgbj"><div class="content svelte-1dlxgbj"><!><span class="typing-cursor svelte-1dlxgbj">|</span></div></div>'),is=D('<div class="typing-indicator svelte-1dlxgbj"><div class="spinner svelte-1dlxgbj"></div> <span class="svelte-1dlxgbj">AI is thinking...</span></div>'),ls=D(`<div class="mb-3 svelte-1dlxgbj"><label for="numCharacters" class="form-label svelte-1dlxgbj">Approximate number of main characters to generate:</label> <input type="number" id="numCharacters" class="form-control svelte-1dlxgbj" min="1" max="20" step="1"></div> <div class="card chat-card svelte-1dlxgbj"><div class="card-header bg-primary text-white svelte-1dlxgbj"><h3 class="h5 mb-0 svelte-1dlxgbj">Character Building Chat</h3></div> <div class="chat-container card-body svelte-1dlxgbj"><p class="lead svelte-1dlxgbj">Chat here to brainstorm ideas for your characters. When you're ready, click
								"Finalize Characters" to generate structured character descriptions based on the
								conversation.</p> <div class="chat-messages-area svelte-1dlxgbj"><!> <!> <!></div> <div class="input-container d-flex svelte-1dlxgbj"><textarea class="form-control svelte-1dlxgbj" placeholder="Describe a character or type your ideas..." rows="1"></textarea> <button class="btn btn-primary ms-2 svelte-1dlxgbj">Send</button></div> <div class="mt-3 text-center svelte-1dlxgbj"><button class="btn btn-success svelte-1dlxgbj">Finalize Characters</button></div></div></div>`,1),os=D('<div class="card results-card svelte-1dlxgbj"><div class="card-header bg-success text-white svelte-1dlxgbj"><h3 class="h5 mb-0 svelte-1dlxgbj">Your Characters</h3></div> <div class="card-body svelte-1dlxgbj"><p class="lead svelte-1dlxgbj">Here are the generated character descriptions. You can edit them directly.</p> <div class="form-group mb-3 svelte-1dlxgbj"><label for="charactersContent" class="form-label svelte-1dlxgbj">Edit your characters:</label> <textarea id="charactersContent" rows="15" class="form-control svelte-1dlxgbj"></textarea></div> <div class="d-flex justify-content-between svelte-1dlxgbj"><button class="save-button btn btn-success svelte-1dlxgbj">Save Characters</button> <a href="/outline" class="btn btn-primary svelte-1dlxgbj">Continue to Outline</a></div></div></div>'),cs=D('<div class="col-12 svelte-1dlxgbj"><div class="world-context mb-4 svelte-1dlxgbj"><h3 class="svelte-1dlxgbj">World Setting Context:</h3> <div class="context-card card bg-light svelte-1dlxgbj"><div class="card-body svelte-1dlxgbj"><p class="card-text small mb-0 svelte-1dlxgbj"> </p> <button class="btn btn-link btn-sm p-0 svelte-1dlxgbj"> </button> <!></div></div></div> <!></div>'),us=D(`<div class="characters-container svelte-1dlxgbj"><div class="row svelte-1dlxgbj"><div class="col-12 mb-4 svelte-1dlxgbj"><div class="card svelte-1dlxgbj"><div class="card-header bg-primary text-white d-flex justify-content-between align-items-center svelte-1dlxgbj"><h1 class="h4 mb-0 svelte-1dlxgbj">Develop Characters</h1> <div class="navigation-buttons svelte-1dlxgbj"><a href="/world" class="btn btn-light svelte-1dlxgbj">&laquo; Previous: World</a> <!></div></div> <div class="card-body svelte-1dlxgbj"><p class="lead svelte-1dlxgbj">Chat with the AI to brainstorm and develop your book's characters. Define their roles,
						personalities, and backstories.</p></div></div></div> <!> <!></div></div>`);function vs(e,t){He(t,!0);let r=k(""),a=k(""),s=k(_e([])),n=k(!1),o=k(5),v=k(!1),u=k(""),c=k(!1),f=k(""),h=null;Ne(()=>{h&&(h.scrollTop=h.scrollHeight)});async function l(){if(!i(u).trim()||i(c))return;const N={role:"user",content:i(u)};d(s,[...i(s),N],!0),d(u,""),d(c,!0),d(f,"");const j={chat_history:i(s),world_theme:i(a),num_characters:i(o)};try{const G=await fetch("/characters_chat_stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(!G.ok||!G.body){const $=await G.text();throw new Error(`HTTP error! status: ${G.status}: ${$}`)}const ie=G.body.getReader(),A=new TextDecoder;let R="";for(;;){const{value:$,done:Z}=await ie.read();if(Z)break;A.decode($).split(`

`).filter(Boolean).forEach(U=>{if(U.startsWith("data: "))try{const x=U.substring(6);if(x==="[DONE]")return;const O=JSON.parse(x);O.content!==void 0&&(R+=O.content,d(f,R,!0))}catch(x){console.error("Error parsing JSON from stream:",x,jsonData),d(f,i(f)+` [Parsing Error: ${x.message}]`)}})}d(s,[...i(s),{role:"assistant",content:R}],!0)}catch(G){console.error("Fetch error for chat stream:",G);const ie=`Error: ${G.message}`;d(s,[...i(s),{role:"system",content:ie}],!0)}finally{d(c,!1),d(f,"")}}function p(N){return N.split(`

`).map(j=>j.startsWith("```")?`<pre><code>${j.substring(3).replace("```","")}</code></pre>`:`<p>${j}</p>`).join("")}let b=kt(()=>i(s).filter(N=>N.role==="user").length===0||i(c));const m="Based on your world setting, what kind of characters are you thinking of? You can describe individuals, archetypes, or groups. I can help you brainstorm or generate character concepts.";Ne(()=>{async function N(){try{const j=await fetch("/api/world");if(!j.ok)throw new Error("Failed to fetch world data");const G=await j.json();d(a,G.world_theme||"No world theme set.",!0);const ie=await fetch("/api/characters");if(!ie.ok)d(s,[{role:"assistant",content:m}],!0),d(v,!1);else{const A=await ie.json();d(r,A.characters||"",!0),i(r)?d(v,!0):(d(s,[{role:"assistant",content:m}],!0),d(v,!1))}}catch(j){console.error("Error loading context data:",j),d(s,[{role:"system",content:`Error loading context data: ${j.message}`},{role:"assistant",content:m}],!0),d(v,!1)}}N()});var E=us(),C=_(E),T=_(C),z=_(T),g=_(z),y=w(_(g),2),M=w(_(y),2);{var L=N=>{var j=es();S(N,j)};W(M,N=>{i(r)&&N(L)})}var q=w(T,2);{var P=N=>{var j=ts();S(N,j)};W(q,N=>{i(a)||N(P)})}var I=w(q,2);{var K=N=>{var j=cs(),G=_(j),ie=w(_(G),2),A=_(ie),R=_(A),$=_(R),Z=w(R,2);Z.__click=[rs,n];var re=_(Z),U=w(Z,2);{var x=H=>{var X=as(),de=_(X),Q=_(de);ne(()=>ue(Q,i(a))),S(H,X)};W(U,H=>{i(n)&&H(x)})}var O=w(G,2);{var F=H=>{var X=ls(),de=at(X),Q=w(_(de),2),oe=w(de,2),ae=w(_(oe),2),le=w(_(ae),2),ze=_(le);$t(ze,17,()=>i(s),Y=>Y.role+Y.content,(Y,ye)=>{var Ce=ns(),$e=_(Ce),Qe=_($e);_t(Qe,()=>p(i(ye).content)),ne(()=>he(Ce,1,`message ${i(ye).role??""}`,"svelte-1dlxgbj")),S(Y,Ce)});var Ee=w(ze,2);{var Be=Y=>{var ye=ss(),Ce=_(ye),$e=_(Ce);_t($e,()=>p(i(f))),S(Y,ye)};W(Ee,Y=>{i(f)&&Y(Be)})}var lt=w(Ee,2);{var ot=Y=>{var ye=is();S(Y,ye)};W(lt,Y=>{i(c)&&!i(f)&&Y(ot)})}Jt(le,Y=>h=Y,()=>h);var ee=w(le,2),te=_(ee),me=w(te,2);me.__click=l;var Xe=w(ee,2),Je=_(Xe);Je.__click=[Xn,s,b,c,f,r,a,o,v],ne(()=>{te.disabled=i(c),me.disabled=i(c),Je.disabled=i(b)}),We(Q,()=>i(o),Y=>d(o,Y)),dr("keypress",te,Y=>{Y.key==="Enter"&&!Y.shiftKey&&(Y.preventDefault(),l())}),We(te,()=>i(u),Y=>d(u,Y)),S(H,X)},se=H=>{var X=os(),de=w(_(X),2),Q=w(_(de),2),oe=w(_(Q),2),ae=w(Q,2),le=_(ae);le.__click=[Qn,r],We(oe,()=>i(r),ze=>d(r,ze)),S(H,X)};W(O,H=>{i(v)?H(se,!1):H(F)})}ne(H=>{ue($,H),ue(re,i(n)?"Show less":"Show more")},[()=>i(n)?i(a):i(a).substring(0,200)+"..."]),S(N,j)};W(I,N=>{i(a)&&N(K)})}S(e,E),qe()}Ze(["click"]);async function ds(e,t,r,a,s,n,o,v,u,c,f){if(i(t).filter(l=>l.role==="user").length===0){alert("Please send at least one message to the AI before finalizing.");return}if(i(r))return;d(a,!0),d(s,""),d(n,"");const h={chat_history:i(t),world_theme:i(o),characters:i(v),num_chapters:i(u)};try{const l=await fetch("/finalize_outline_stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!l.ok||!l.body){const E=await l.text();throw new Error(`HTTP error! status: ${l.status}: ${E}`)}const p=l.body.getReader(),b=new TextDecoder;let m="";for(;;){const{value:E,done:C}=await p.read();if(C)break;b.decode(E).split(`

`).filter(Boolean).forEach(z=>{if(z.startsWith("data: "))try{const g=z.substring(6);if(g==="[DONE]")return;const y=JSON.parse(g);y.content!==void 0&&(m+=y.content,d(n,m,!0))}catch(g){console.error("Error parsing JSON from finalize stream:",g,jsonData),d(n,i(n)+` [Parsing Error: ${g.message}]`)}})}d(f,!0)}catch(l){console.error("Fetch error for final outline:",l),d(n,`Error finalizing outline: ${l.message}

`+i(n)),d(f,!0)}finally{d(a,!1),d(s,"")}}async function fs(e,t){const r={outline:i(t)};try{const a=await fetch("/save_outline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){const s=await a.text();throw new Error(`HTTP error! status: ${a.status}: ${s}`)}alert("Outline saved successfully!")}catch(a){console.error("Error saving outline:",a),alert(`Failed to save outline: ${a.message}`)}}var _s=D('<a href="/chapters" class="btn btn-light svelte-1nwz8wi">Next: Chapters &raquo;</a>'),hs=D('<div class="col-12 mb-4 svelte-1nwz8wi"><div class="alert alert-warning svelte-1nwz8wi"><strong class="svelte-1nwz8wi">Context needed!</strong> Please ensure you have set your <a href="/world" class="alert-link svelte-1nwz8wi">World Setting</a> and <a href="/characters" class="alert-link svelte-1nwz8wi">Characters</a> before generating an outline.</div></div>'),ps=(e,t)=>d(t,!i(t)),ws=(e,t)=>d(t,!i(t)),bs=D('<div><div class="content svelte-1nwz8wi"><!></div></div>'),gs=D('<div class="message assistant svelte-1nwz8wi"><div class="content svelte-1nwz8wi"><!><span class="typing-cursor svelte-1nwz8wi">|</span></div></div>'),ms=D('<div class="typing-indicator svelte-1nwz8wi"><div class="spinner svelte-1nwz8wi"></div> <span class="svelte-1nwz8wi">AI is thinking...</span></div>'),ys=D(`<div class="mb-3 svelte-1nwz8wi"><label for="numChapters" class="form-label svelte-1nwz8wi">Approximate number of chapters for the final outline:</label> <input type="number" id="numChapters" class="form-control svelte-1nwz8wi" min="1" max="100" step="1"></div> <div class="card chat-card svelte-1nwz8wi"><div class="card-header bg-primary text-white svelte-1nwz8wi"><h3 class="h5 mb-0 svelte-1nwz8wi">Outline Building Chat</h3></div> <div class="chat-container card-body svelte-1nwz8wi"><p class="lead svelte-1nwz8wi">Chat here to brainstorm ideas for your outline. When you're ready, click "Finalize
								Outline" to generate a structured outline based on the conversation.</p> <div class="chat-messages-area svelte-1nwz8wi"><!> <!> <!></div> <div class="input-container d-flex svelte-1nwz8wi"><textarea class="form-control svelte-1nwz8wi" placeholder="Type your ideas about the outline..." rows="1"></textarea> <button class="btn btn-primary ms-2 svelte-1nwz8wi">Send</button></div> <div class="mt-3 text-center svelte-1nwz8wi"><button class="btn btn-success svelte-1nwz8wi">Finalize Outline</button></div></div></div>`,1),xs=D('<li class="list-group-item svelte-1nwz8wi"><strong class="svelte-1nwz8wi"> </strong> <p class="text-muted small mb-0 svelte-1nwz8wi"> </p></li>'),Es=D('<div class="mt-3 svelte-1nwz8wi"><h4 class="svelte-1nwz8wi">Generated Chapters:</h4> <button class="btn btn-sm btn-secondary mb-2 svelte-1nwz8wi">Regenerate Chapters from Outline</button> <ul class="list-group list-group-flush svelte-1nwz8wi"></ul></div>'),Cs=D('<div class="card results-card svelte-1nwz8wi"><div class="card-header bg-success text-white svelte-1nwz8wi"><h3 class="h5 mb-0 svelte-1nwz8wi">Your Outline</h3></div> <div class="card-body svelte-1nwz8wi"><p class="lead svelte-1nwz8wi">Here is the generated outline. You can edit it directly.</p> <div class="form-group mb-3 svelte-1nwz8wi"><label for="outlineContent" class="form-label svelte-1nwz8wi">Edit your outline:</label> <textarea id="outlineContent" rows="15" class="form-control svelte-1nwz8wi"></textarea></div> <div class="d-flex justify-content-between align-items-center svelte-1nwz8wi"><button class="save-button btn btn-success svelte-1nwz8wi">Save Outline</button> <a href="/chapters" class="btn btn-primary svelte-1nwz8wi">Continue to Chapters</a></div> <!></div></div>'),Ts=D('<div class="col-12 svelte-1nwz8wi"><div class="context-accordion mb-4 svelte-1nwz8wi"><div class="accordion svelte-1nwz8wi" id="contextAccordion"><div class="accordion-item svelte-1nwz8wi"><h2 class="accordion-header svelte-1nwz8wi" id="worldContextHeading"><button class="accordion-button collapsed svelte-1nwz8wi" type="button" data-bs-toggle="collapse" data-bs-target="#worldContextCollapse" aria-controls="worldContextCollapse">World Setting</button></h2> <div id="worldContextCollapse" aria-labelledby="worldContextHeading" data-bs-parent="#contextAccordion"><div class="accordion-body small svelte-1nwz8wi"><p class="svelte-1nwz8wi"> </p></div></div></div> <div class="accordion-item svelte-1nwz8wi"><h2 class="accordion-header svelte-1nwz8wi" id="charactersContextHeading"><button class="accordion-button collapsed svelte-1nwz8wi" type="button" data-bs-toggle="collapse" data-bs-target="#charactersContextCollapse" aria-controls="charactersContextCollapse">Characters</button></h2> <div id="charactersContextCollapse" aria-labelledby="charactersContextHeading" data-bs-parent="#contextAccordion"><div class="accordion-body small svelte-1nwz8wi"><p class="svelte-1nwz8wi"> </p></div></div></div></div></div> <!></div>'),ks=D(`<div class="outline-container svelte-1nwz8wi"><div class="row svelte-1nwz8wi"><div class="col-12 mb-4 svelte-1nwz8wi"><div class="card svelte-1nwz8wi"><div class="card-header bg-primary text-white d-flex justify-content-between align-items-center svelte-1nwz8wi"><h1 class="h4 mb-0 svelte-1nwz8wi">Develop Outline</h1> <div class="navigation-buttons svelte-1nwz8wi"><a href="/characters" class="btn btn-light svelte-1nwz8wi">&laquo; Previous: Characters</a> <!></div></div> <div class="card-body svelte-1nwz8wi"><p class="lead svelte-1nwz8wi">Chat with the AI to brainstorm and refine your book's outline. You can generate a full
						outline and then break it down into individual chapters.</p></div></div></div> <!> <!></div></div>`);function zs(e,t){He(t,!0);let r=k(""),a=k(_e([])),s=k(""),n=k(""),o=k(10),v=k(!1),u=k(!1),c=k(!1),f=k(_e([])),h=k(""),l=k(!1),p=k(""),b=null;Ne(()=>{b&&(b.scrollTop=b.scrollHeight)});async function m(){if(!i(h).trim()||i(l))return;const A={role:"user",content:i(h)};d(f,[...i(f),A],!0),d(h,""),d(l,!0),d(p,"");const R={chat_history:i(f),world_theme:i(s),characters:i(n),num_chapters:i(o)};try{const $=await fetch("/outline_chat_stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)});if(!$.ok||!$.body){const x=await $.text();throw new Error(`HTTP error! status: ${$.status}: ${x}`)}const Z=$.body.getReader(),re=new TextDecoder;let U="";for(;;){const{value:x,done:O}=await Z.read();if(O)break;re.decode(x).split(`

`).filter(Boolean).forEach(se=>{if(se.startsWith("data: "))try{const H=se.substring(6);if(H==="[DONE]")return;const X=JSON.parse(H);X.content!==void 0&&(U+=X.content,d(p,U,!0))}catch(H){console.error("Error parsing JSON from stream:",H,jsonData),d(p,i(p)+` [Parsing Error: ${H.message}]`)}})}d(f,[...i(f),{role:"assistant",content:U}],!0)}catch($){console.error("Fetch error for chat stream:",$);const Z=`Error: ${$.message}`;d(f,[...i(f),{role:"system",content:Z}],!0)}finally{d(l,!1),d(p,"")}}function E(A){return A.split(`

`).map(R=>R.startsWith("```")?`<pre><code>${R.substring(3).replace("```","")}</code></pre>`:`<p>${R}</p>`).join("")}let C=kt(()=>i(f).filter(A=>A.role==="user").length===0||i(l));const T="Based on the world setting and characters, what kind of plot outline or story beats are you thinking of?";Ne(()=>{async function A(){try{const R=await fetch("/api/world");if(!R.ok)throw new Error("Failed to fetch world data");const $=await R.json();d(s,$.world_theme||"No world theme set.",!0);const Z=await fetch("/api/characters");if(!Z.ok)throw new Error("Failed to fetch characters data");const re=await Z.json();d(n,re.characters||"No characters set.",!0);const U=await fetch("/api/outline");if(!U.ok)d(f,[{role:"assistant",content:T}],!0),d(c,!1);else{const x=await U.json();d(r,x.outline||"",!0),i(r)?d(c,!0):(d(f,[{role:"assistant",content:T}],!0),d(c,!1))}}catch(R){console.error("Error loading context data:",R),d(f,[{role:"system",content:`Error loading context data: ${R.message}`},{role:"assistant",content:T}],!0),d(c,!1)}}A()});async function z(){if(!i(r)){alert("Please finalize the outline first.");return}d(l,!0),d(a,[],!0);let A="";const R={outline:i(r)};try{const $=await fetch("/regenerate_chapters_stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)});if(!$.ok||!$.body){const U=await $.text();throw new Error(`HTTP error! status: ${$.status}: ${U}`)}const Z=$.body.getReader(),re=new TextDecoder;for(;;){const{value:U,done:x}=await Z.read();if(x)break;const O=re.decode(U);A+=O}}catch($){console.error("Fetch error for regenerating chapters:",$),alert(`Failed to regenerate chapters: ${$.message}`),d(a,[],!0)}finally{d(l,!1)}}var g=ks(),y=_(g),M=_(y),L=_(M),q=_(L),P=w(_(q),2),I=w(_(P),2);{var K=A=>{var R=_s();S(A,R)};W(I,A=>{i(a).length>0&&A(K)})}var N=w(M,2);{var j=A=>{var R=hs();S(A,R)};W(N,A=>{(!i(s)||!i(n))&&A(j)})}var G=w(N,2);{var ie=A=>{var R=Ts(),$=_(R),Z=_($),re=_(Z),U=_(re),x=_(U);x.__click=[ps,v];var O=w(U,2);let F;var se=_(O),H=_(se),X=_(H),de=w(re,2),Q=_(de),oe=_(Q);oe.__click=[ws,u];var ae=w(Q,2);let le;var ze=_(ae),Ee=_(ze),Be=_(Ee),lt=w($,2);{var ot=te=>{var me=ys(),Xe=at(me),Je=w(_(Xe),2),Y=w(Xe,2),ye=w(_(Y),2),Ce=w(_(ye),2),$e=_(Ce);$t($e,17,()=>i(f),V=>V.role+V.content,(V,De)=>{var Ue=bs(),Yt=_(Ue),sa=_(Yt);_t(sa,()=>E(i(De).content)),ne(()=>he(Ue,1,`message ${i(De).role??""}`,"svelte-1nwz8wi")),S(V,Ue)});var Qe=w($e,2);{var Ye=V=>{var De=gs(),Ue=_(De),Yt=_(Ue);_t(Yt,()=>E(i(p))),S(V,De)};W(Qe,V=>{i(p)&&V(Ye)})}var wt=w(Qe,2);{var bt=V=>{var De=ms();S(V,De)};W(wt,V=>{i(l)&&!i(p)&&V(bt)})}Jt(Ce,V=>b=V,()=>b);var gt=w(Ce,2),et=_(gt),ct=w(et,2);ct.__click=m;var mt=w(gt,2),ut=_(mt);ut.__click=[ds,f,C,l,p,r,s,n,o,a,c],ne(()=>{et.disabled=i(l),ct.disabled=i(l),ut.disabled=i(C)}),We(Je,()=>i(o),V=>d(o,V)),dr("keypress",et,V=>{V.key==="Enter"&&!V.shiftKey&&(V.preventDefault(),m())}),We(et,()=>i(h),V=>d(h,V)),S(te,me)},ee=te=>{var me=Cs(),Xe=w(_(me),2),Je=w(_(Xe),2),Y=w(_(Je),2),ye=w(Je,2),Ce=_(ye);Ce.__click=[fs,r];var $e=w(ye,2);{var Qe=Ye=>{var wt=Es(),bt=w(_(wt),2);bt.__click=z;var gt=w(bt,2);$t(gt,21,()=>i(a),na,(et,ct)=>{var mt=xs(),ut=_(mt),V=_(ut),De=w(ut,2),Ue=_(De);ne(()=>{ue(V,i(ct).title),ue(Ue,i(ct).summary)}),S(et,mt)}),S(Ye,wt)};W($e,Ye=>{i(a).length>0&&Ye(Qe)})}We(Y,()=>i(r),Ye=>d(r,Ye)),S(te,me)};W(lt,te=>{i(c)?te(ee,!1):te(ot)})}ne((te,me)=>{er(x,"aria-expanded",i(v)),F=he(O,1,"accordion-collapse collapse svelte-1nwz8wi",null,F,te),ue(X,i(s)),er(oe,"aria-expanded",i(u)),le=he(ae,1,"accordion-collapse collapse svelte-1nwz8wi",null,le,me),ue(Be,i(n))},[()=>({show:i(v)}),()=>({show:i(u)})]),S(A,R)};W(G,A=>{i(s)&&i(n)&&A(ie)})}S(e,g),qe()}Ze(["click"]);Ze(["click"]);var Ss=D("<p>Page not found</p>"),js=D('<!> <main class="svelte-1k41oz3"><!></main>',1);function Os(e,t){He(t,!0);let r=k(_e(window.location.pathname));Ne(()=>{window.addEventListener("popstate",()=>{d(r,window.location.pathname,!0)})});var a=js(),s=at(a);kn(s,{});var n=w(s,2),o=_(n);{var v=c=>{Pn(c,{})},u=(c,f)=>{{var h=p=>{Zn(p,{})},l=(p,b)=>{{var m=C=>{vs(C,{})},E=(C,T)=>{{var z=y=>{zs(y,{})},g=y=>{var M=Ss();S(y,M)};W(C,y=>{i(r)==="/outline"?y(z):y(g,!1)},T)}};W(p,C=>{i(r)==="/characters"?C(m):C(E,!1)},b)}};W(c,p=>{i(r)==="/world"?p(h):p(l,!1)},f)}};W(o,c=>{i(r)==="/"?c(v):c(u,!1)})}S(e,a),qe()}sn(Os,{target:document.getElementById("app")});
