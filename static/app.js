(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(s){if(s.ep)return;s.ep=!0;const l=r(s);fetch(s.href,l)}})();const Tr=!1;var pr=Array.isArray,wa=Array.prototype.indexOf,br=Array.from,xa=Object.defineProperty,ht=Object.getOwnPropertyDescriptor,Ea=Object.getOwnPropertyDescriptors,ka=Object.prototype,Ca=Array.prototype,zr=Object.getPrototypeOf,Sr=Object.isExtensible;const Mt=()=>{};function Ta(e){for(var t=0;t<e.length;t++)e[t]()}const De=2,Wr=4,Kt=8,gr=16,Ze=32,gt=64,Lt=128,Ae=256,zt=512,Te=1024,We=2048,it=4096,Ve=8192,Zt=16384,Sa=32768,Xt=65536,Oa=1<<19,Hr=1<<20,dr=1<<21,st=Symbol("$state"),Aa=Symbol("legacy props"),Pa=Symbol("");function Br(e){return e===this.v}function Ra(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function mr(e){return!Ra(e,this.v)}function qa(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Da(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function $a(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Na(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ia(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function ja(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Fa(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ma(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let La=!1;const yr=1,wr=2,Gr=4,za=8,Wa=16,Ha=1,Ba=4,Ga=8,Ja=16,Ya=1,Va=2,Ee=Symbol(),Ua="http://www.w3.org/1999/xhtml";function Ka(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let Ce=null;function Or(e){Ce=e}function Be(e,t=!1,r){var a=Ce={p:Ce,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};ta(()=>{a.d=!0})}function Ge(e){const t=Ce;if(t!==null){const o=t.e;if(o!==null){var r=se,a=ne;t.e=null;try{for(var s=0;s<o.length;s++){var l=o[s];tt(l.effect),He(l.reaction),Ot(l.fn)}}finally{tt(r),He(a)}}Ce=t.p,t.m=!0}return{}}function Jr(){return!0}function me(e){if(typeof e!="object"||e===null||st in e)return e;const t=zr(e);if(t!==ka&&t!==Ca)return e;var r=new Map,a=pr(e),s=F(0),l=ne,o=u=>{var v=ne;He(l);var f=u();return He(v),f};return a&&r.set("length",F(e.length)),new Proxy(e,{defineProperty(u,v,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&ja();var _=r.get(v);return _===void 0?(_=o(()=>F(f.value)),r.set(v,_)):c(_,o(()=>me(f.value))),!0},deleteProperty(u,v){var f=r.get(v);if(f===void 0)v in u&&(r.set(v,o(()=>F(Ee))),or(s));else{if(a&&typeof v=="string"){var _=r.get("length"),b=Number(v);Number.isInteger(b)&&b<_.v&&c(_,b)}c(f,Ee),or(s)}return!0},get(u,v,f){var p;if(v===st)return e;var _=r.get(v),b=v in u;if(_===void 0&&(!b||(p=ht(u,v))!=null&&p.writable)&&(_=o(()=>F(me(b?u[v]:Ee))),r.set(v,_)),_!==void 0){var d=n(_);return d===Ee?void 0:d}return Reflect.get(u,v,f)},getOwnPropertyDescriptor(u,v){var f=Reflect.getOwnPropertyDescriptor(u,v);if(f&&"value"in f){var _=r.get(v);_&&(f.value=n(_))}else if(f===void 0){var b=r.get(v),d=b==null?void 0:b.v;if(b!==void 0&&d!==Ee)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return f},has(u,v){var d;if(v===st)return!0;var f=r.get(v),_=f!==void 0&&f.v!==Ee||Reflect.has(u,v);if(f!==void 0||se!==null&&(!_||(d=ht(u,v))!=null&&d.writable)){f===void 0&&(f=o(()=>F(_?me(u[v]):Ee)),r.set(v,f));var b=n(f);if(b===Ee)return!1}return _},set(u,v,f,_){var A;var b=r.get(v),d=v in u;if(a&&v==="length")for(var p=f;p<b.v;p+=1){var g=r.get(p+"");g!==void 0?c(g,Ee):p in u&&(g=o(()=>F(Ee)),r.set(p+"",g))}b===void 0?(!d||(A=ht(u,v))!=null&&A.writable)&&(b=o(()=>F(void 0)),c(b,o(()=>me(f))),r.set(v,b)):(d=b.v!==Ee,c(b,o(()=>me(f))));var E=Reflect.getOwnPropertyDescriptor(u,v);if(E!=null&&E.set&&E.set.call(_,f),!d){if(a&&typeof v=="string"){var I=r.get("length"),R=Number(v);Number.isInteger(R)&&R>=I.v&&c(I,R+1)}or(s)}return!0},ownKeys(u){n(s);var v=Reflect.ownKeys(u).filter(b=>{var d=r.get(b);return d===void 0||d.v!==Ee});for(var[f,_]of r)_.v!==Ee&&!(f in u)&&v.push(f);return v},setPrototypeOf(){Fa()}})}function or(e,t=1){c(e,e.v+t)}function Ar(e){try{if(e!==null&&typeof e=="object"&&st in e)return e[st]}catch{}return e}function Za(e,t){return Object.is(Ar(e),Ar(t))}function Qt(e){var t=De|We,r=ne!==null&&(ne.f&De)!==0?ne:null;return se===null||r!==null&&(r.f&Ae)!==0?t|=Ae:se.f|=Hr,{ctx:Ce,deps:null,effects:null,equals:Br,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:r??se}}function ze(e){const t=Qt(e);return ca(t),t}function Xa(e){const t=Qt(e);return t.equals=mr,t}function Yr(e){var t=e.effects;if(t!==null){e.effects=null;for(var r=0;r<t.length;r+=1)Ke(t[r])}}function Qa(e){for(var t=e.parent;t!==null;){if((t.f&De)===0)return t;t=t.parent}return null}function Vr(e){var t,r=se;tt(Qa(e));try{Yr(e),t=fa(e)}finally{tt(r)}return t}function Ur(e){var t=Vr(e),r=(et||(e.f&Ae)!==0)&&e.deps!==null?it:Te;Ne(e,r),e.equals(t)||(e.v=t,e.wv=da())}const kt=new Map;function Wt(e,t){var r={f:0,v:e,reactions:null,equals:Br,rv:0,wv:0};return r}function F(e,t){const r=Wt(e);return ca(r),r}function Kr(e,t=!1){const r=Wt(e);return t||(r.equals=mr),r}function c(e,t,r=!1){ne!==null&&!Fe&&Jr()&&(ne.f&(De|gr))!==0&&!(xe!=null&&xe.includes(e))&&Ma();let a=r?me(t):t;return ur(e,a)}function ur(e,t){if(!e.equals(t)){var r=e.v;At?kt.set(e,t):kt.set(e,r),e.v=t,(e.f&De)!==0&&((e.f&We)!==0&&Vr(e),Ne(e,(e.f&Ae)===0?Te:it)),e.wv=da(),Zr(e,We),se!==null&&(se.f&Te)!==0&&(se.f&(Ze|gt))===0&&(Re===null?cn([e]):Re.push(e))}return t}function Zr(e,t){var r=e.reactions;if(r!==null)for(var a=r.length,s=0;s<a;s++){var l=r[s],o=l.f;(o&We)===0&&(Ne(l,t),(o&(Te|Ae))!==0&&((o&De)!==0?Zr(l,it):nr(l)))}}let en=!1;var Pr,Xr,Qr,ea;function tn(){if(Pr===void 0){Pr=window,Xr=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,r=Text.prototype;Qr=ht(t,"firstChild").get,ea=ht(t,"nextSibling").get,Sr(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),Sr(r)&&(r.__t=void 0)}}function er(e=""){return document.createTextNode(e)}function Le(e){return Qr.call(e)}function tr(e){return ea.call(e)}function i(e,t){return Le(e)}function $e(e,t){{var r=Le(e);return r instanceof Comment&&r.data===""?tr(r):r}}function h(e,t=1,r=!1){let a=e;for(;t--;)a=tr(a);return a}function rn(e){e.textContent=""}function an(e){se===null&&ne===null&&$a(),ne!==null&&(ne.f&Ae)!==0&&se===null&&Da(),At&&qa()}function nn(e,t){var r=t.last;r===null?t.last=t.first=e:(r.next=e,e.prev=r,t.last=e)}function mt(e,t,r,a=!0){var s=se,l={ctx:Ce,deps:null,nodes_start:null,nodes_end:null,f:e|We,first:null,fn:t,last:null,next:null,parent:s,prev:null,teardown:null,transitions:null,wv:0};if(r)try{kr(l),l.f|=Sa}catch(v){throw Ke(l),v}else t!==null&&nr(l);var o=r&&l.deps===null&&l.first===null&&l.nodes_start===null&&l.teardown===null&&(l.f&(Hr|Lt))===0;if(!o&&a&&(s!==null&&nn(l,s),ne!==null&&(ne.f&De)!==0)){var u=ne;(u.effects??(u.effects=[])).push(l)}return l}function ta(e){const t=mt(Kt,null,!1);return Ne(t,Te),t.teardown=e,t}function Ue(e){an();var t=se!==null&&(se.f&Ze)!==0&&Ce!==null&&!Ce.m;if(t){var r=Ce;(r.e??(r.e=[])).push({fn:e,effect:se,reaction:ne})}else{var a=Ot(e);return a}}function sn(e){const t=mt(gt,e,!0);return(r={})=>new Promise(a=>{r.outro?Ht(t,()=>{Ke(t),a(void 0)}):(Ke(t),a(void 0))})}function Ot(e){return mt(Wr,e,!1)}function ra(e){return mt(Kt,e,!0)}function G(e,t=[],r=Qt){const a=t.map(r);return rr(()=>e(...a.map(n)))}function rr(e,t=0){return mt(Kt|gr|t,e,!0)}function _t(e,t=!0){return mt(Kt|Ze,e,!0,t)}function aa(e){var t=e.teardown;if(t!==null){const r=At,a=ne;Rr(!0),He(null);try{t.call(null)}finally{Rr(r),He(a)}}}function na(e,t=!1){var r=e.first;for(e.first=e.last=null;r!==null;){var a=r.next;(r.f&gt)!==0?r.parent=null:Ke(r,t),r=a}}function ln(e){for(var t=e.first;t!==null;){var r=t.next;(t.f&Ze)===0&&Ke(t),t=r}}function Ke(e,t=!0){var r=!1;(t||(e.f&Oa)!==0)&&e.nodes_start!==null&&(sa(e.nodes_start,e.nodes_end),r=!0),na(e,t&&!r),Vt(e,0),Ne(e,Zt);var a=e.transitions;if(a!==null)for(const l of a)l.stop();aa(e);var s=e.parent;s!==null&&s.first!==null&&la(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function sa(e,t){for(;e!==null;){var r=e===t?null:tr(e);e.remove(),e=r}}function la(e){var t=e.parent,r=e.prev,a=e.next;r!==null&&(r.next=a),a!==null&&(a.prev=r),t!==null&&(t.first===e&&(t.first=a),t.last===e&&(t.last=r))}function Ht(e,t){var r=[];xr(e,r,!0),ia(r,()=>{Ke(e),t&&t()})}function ia(e,t){var r=e.length;if(r>0){var a=()=>--r||t();for(var s of e)s.out(a)}else t()}function xr(e,t,r){if((e.f&Ve)===0){if(e.f^=Ve,e.transitions!==null)for(const o of e.transitions)(o.is_global||r)&&t.push(o);for(var a=e.first;a!==null;){var s=a.next,l=(a.f&Xt)!==0||(a.f&Ze)!==0;xr(a,t,l?r:!1),a=s}}}function Bt(e){oa(e,!0)}function oa(e,t){if((e.f&Ve)!==0){e.f^=Ve,(e.f&Te)===0&&(e.f^=Te),Pt(e)&&(Ne(e,We),nr(e));for(var r=e.first;r!==null;){var a=r.next,s=(r.f&Xt)!==0||(r.f&Ze)!==0;oa(r,s?t:!1),r=a}if(e.transitions!==null)for(const l of e.transitions)(l.is_global||t)&&l.in()}}let Gt=[];function on(){var e=Gt;Gt=[],Ta(e)}function Er(e){Gt.length===0&&queueMicrotask(on),Gt.push(e)}let It=!1,fr=!1,Jt=null,lt=!1,At=!1;function Rr(e){At=e}let jt=[];let ne=null,Fe=!1;function He(e){ne=e}let se=null;function tt(e){se=e}let xe=null;function ca(e){ne!==null&&ne.f&dr&&(xe===null?xe=[e]:xe.push(e))}let we=null,Oe=0,Re=null;function cn(e){Re=e}let va=1,Yt=0,et=!1;function da(){return++va}function Pt(e){var b;var t=e.f;if((t&We)!==0)return!0;if((t&it)!==0){var r=e.deps,a=(t&Ae)!==0;if(r!==null){var s,l,o=(t&zt)!==0,u=a&&se!==null&&!et,v=r.length;if(o||u){var f=e,_=f.parent;for(s=0;s<v;s++)l=r[s],(o||!((b=l==null?void 0:l.reactions)!=null&&b.includes(f)))&&(l.reactions??(l.reactions=[])).push(f);o&&(f.f^=zt),u&&_!==null&&(_.f&Ae)===0&&(f.f^=Ae)}for(s=0;s<v;s++)if(l=r[s],Pt(l)&&Ur(l),l.wv>e.wv)return!0}(!a||se!==null&&!et)&&Ne(e,Te)}return!1}function vn(e,t){for(var r=t;r!==null;){if((r.f&Lt)!==0)try{r.fn(e);return}catch{r.f^=Lt}r=r.parent}throw It=!1,e}function qr(e){return(e.f&Zt)===0&&(e.parent===null||(e.parent.f&Lt)===0)}function ar(e,t,r,a){if(It){if(r===null&&(It=!1),qr(t))throw e;return}if(r!==null&&(It=!0),vn(e,t),qr(t))throw e}function ua(e,t,r=!0){var a=e.reactions;if(a!==null)for(var s=0;s<a.length;s++){var l=a[s];xe!=null&&xe.includes(e)||((l.f&De)!==0?ua(l,t,!1):t===l&&(r?Ne(l,We):(l.f&Te)!==0&&Ne(l,it),nr(l)))}}function fa(e){var p;var t=we,r=Oe,a=Re,s=ne,l=et,o=xe,u=Ce,v=Fe,f=e.f;we=null,Oe=0,Re=null,et=(f&Ae)!==0&&(Fe||!lt||ne===null),ne=(f&(Ze|gt))===0?e:null,xe=null,Or(e.ctx),Fe=!1,Yt++,e.f|=dr;try{var _=(0,e.fn)(),b=e.deps;if(we!==null){var d;if(Vt(e,Oe),b!==null&&Oe>0)for(b.length=Oe+we.length,d=0;d<we.length;d++)b[Oe+d]=we[d];else e.deps=b=we;if(!et)for(d=Oe;d<b.length;d++)((p=b[d]).reactions??(p.reactions=[])).push(e)}else b!==null&&Oe<b.length&&(Vt(e,Oe),b.length=Oe);if(Jr()&&Re!==null&&!Fe&&b!==null&&(e.f&(De|it|We))===0)for(d=0;d<Re.length;d++)ua(Re[d],e);return s!==null&&s!==e&&(Yt++,Re!==null&&(a===null?a=Re:a.push(...Re))),_}finally{we=t,Oe=r,Re=a,ne=s,et=l,xe=o,Or(u),Fe=v,e.f^=dr}}function dn(e,t){let r=t.reactions;if(r!==null){var a=wa.call(r,e);if(a!==-1){var s=r.length-1;s===0?r=t.reactions=null:(r[a]=r[s],r.pop())}}r===null&&(t.f&De)!==0&&(we===null||!we.includes(t))&&(Ne(t,it),(t.f&(Ae|zt))===0&&(t.f^=zt),Yr(t),Vt(t,0))}function Vt(e,t){var r=e.deps;if(r!==null)for(var a=t;a<r.length;a++)dn(e,r[a])}function kr(e){var t=e.f;if((t&Zt)===0){Ne(e,Te);var r=se,a=Ce,s=lt;se=e,lt=!0;try{(t&gr)!==0?ln(e):na(e),aa(e);var l=fa(e);e.teardown=typeof l=="function"?l:null,e.wv=va;var o=e.deps,u;Tr&&La&&e.f&We}catch(v){ar(v,e,r,a||e.ctx)}finally{lt=s,se=r}}}function un(){try{Na()}catch(e){if(Jt!==null)ar(e,Jt,null);else throw e}}function fn(){var e=lt;try{var t=0;for(lt=!0;jt.length>0;){t++>1e3&&un();var r=jt,a=r.length;jt=[];for(var s=0;s<a;s++){var l=_n(r[s]);hn(l)}kt.clear()}}finally{fr=!1,lt=e,Jt=null}}function hn(e){var t=e.length;if(t!==0)for(var r=0;r<t;r++){var a=e[r];if((a.f&(Zt|Ve))===0)try{Pt(a)&&(kr(a),a.deps===null&&a.first===null&&a.nodes_start===null&&(a.teardown===null?la(a):a.fn=null))}catch(s){ar(s,a,null,a.ctx)}}}function nr(e){fr||(fr=!0,queueMicrotask(fn));for(var t=Jt=e;t.parent!==null;){t=t.parent;var r=t.f;if((r&(gt|Ze))!==0){if((r&Te)===0)return;t.f^=Te}}jt.push(t)}function _n(e){for(var t=[],r=e;r!==null;){var a=r.f,s=(a&(Ze|gt))!==0,l=s&&(a&Te)!==0;if(!l&&(a&Ve)===0){if((a&Wr)!==0)t.push(r);else if(s)r.f^=Te;else try{Pt(r)&&kr(r)}catch(v){ar(v,r,null,r.ctx)}var o=r.first;if(o!==null){r=o;continue}}var u=r.parent;for(r=r.next;r===null&&u!==null;)r=u.next,u=u.parent}return t}function n(e){var t=e.f,r=(t&De)!==0;if(ne!==null&&!Fe){if(!(xe!=null&&xe.includes(e))){var a=ne.deps;e.rv<Yt&&(e.rv=Yt,we===null&&a!==null&&a[Oe]===e?Oe++:we===null?we=[e]:(!et||!we.includes(e))&&we.push(e))}}else if(r&&e.deps===null&&e.effects===null){var s=e,l=s.parent;l!==null&&(l.f&Ae)===0&&(s.f^=Ae)}return r&&(s=e,Pt(s)&&Ur(s)),At&&kt.has(e)?kt.get(e):e.v}function Ct(e){var t=Fe;try{return Fe=!0,e()}finally{Fe=t}}const pn=-7169;function Ne(e,t){e.f=e.f&pn|t}const bn=["touchstart","touchmove"];function gn(e){return bn.includes(e)}let Dr=!1;function mn(){Dr||(Dr=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const r of e.target.elements)(t=r.__on_r)==null||t.call(r)})},{capture:!0}))}function ha(e){var t=ne,r=se;He(null),tt(null);try{return e()}finally{He(t),tt(r)}}function _a(e,t,r,a=r){e.addEventListener(t,()=>ha(r));const s=e.__on_r;s?e.__on_r=()=>{s(),a(!0)}:e.__on_r=()=>a(!0),mn()}const pa=new Set,hr=new Set;function yn(e,t,r,a={}){function s(l){if(a.capture||xt.call(t,l),!l.cancelBubble)return ha(()=>r==null?void 0:r.call(this,l))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Er(()=>{t.addEventListener(e,s,a)}):t.addEventListener(e,s,a),s}function sr(e,t,r,a,s){var l={capture:a,passive:s},o=yn(e,t,r,l);(t===document.body||t===window||t===document)&&ta(()=>{t.removeEventListener(e,o,l)})}function Ie(e){for(var t=0;t<e.length;t++)pa.add(e[t]);for(var r of hr)r(e)}function xt(e){var A;var t=this,r=t.ownerDocument,a=e.type,s=((A=e.composedPath)==null?void 0:A.call(e))||[],l=s[0]||e.target,o=0,u=e.__root;if(u){var v=s.indexOf(u);if(v!==-1&&(t===document||t===window)){e.__root=t;return}var f=s.indexOf(t);if(f===-1)return;v<=f&&(o=v)}if(l=s[o]||e.target,l!==t){xa(e,"currentTarget",{configurable:!0,get(){return l||r}});var _=ne,b=se;He(null),tt(null);try{for(var d,p=[];l!==null;){var g=l.assignedSlot||l.parentNode||l.host||null;try{var E=l["__"+a];if(E!=null&&(!l.disabled||e.target===l))if(pr(E)){var[I,...R]=E;I.apply(l,[e,...R])}else E.call(l,e)}catch(j){d?p.push(j):d=j}if(e.cancelBubble||g===t||g===null)break;l=g}if(d){for(let j of p)queueMicrotask(()=>{throw j});throw d}}finally{e.__root=t,delete e.currentTarget,He(_),tt(b)}}}function Cr(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function pt(e,t){var r=se;r.nodes_start===null&&(r.nodes_start=e,r.nodes_end=t)}function C(e,t){var r=(t&Ya)!==0,a=(t&Va)!==0,s,l=!e.startsWith("<!>");return()=>{s===void 0&&(s=Cr(l?e:"<!>"+e),r||(s=Le(s)));var o=a||Xr?document.importNode(s,!0):s.cloneNode(!0);if(r){var u=Le(o),v=o.lastChild;pt(u,v)}else pt(o,o);return o}}function wn(e,t,r="svg"){var a=!e.startsWith("<!>"),s=`<${r}>${a?e:"<!>"+e}</${r}>`,l;return()=>{if(!l){var o=Cr(s),u=Le(o);l=Le(u)}var v=l.cloneNode(!0);return pt(v,v),v}}function ke(e=""){{var t=er(e+"");return pt(t,t),t}}function Ut(){var e=document.createDocumentFragment(),t=document.createComment(""),r=er();return e.append(t,r),pt(t,r),e}function m(e,t){e!==null&&e.before(t)}function te(e,t){var r=t==null?"":typeof t=="object"?t+"":t;r!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=r,e.nodeValue=r+"")}function xn(e,t){return En(e,t)}const ut=new Map;function En(e,{target:t,anchor:r,props:a={},events:s,context:l,intro:o=!0}){tn();var u=new Set,v=b=>{for(var d=0;d<b.length;d++){var p=b[d];if(!u.has(p)){u.add(p);var g=gn(p);t.addEventListener(p,xt,{passive:g});var E=ut.get(p);E===void 0?(document.addEventListener(p,xt,{passive:g}),ut.set(p,1)):ut.set(p,E+1)}}};v(br(pa)),hr.add(v);var f=void 0,_=sn(()=>{var b=r??t.appendChild(er());return _t(()=>{if(l){Be({});var d=Ce;d.c=l}s&&(a.$$events=s),f=e(b,a)||{},l&&Ge()}),()=>{var g;for(var d of u){t.removeEventListener(d,xt);var p=ut.get(d);--p===0?(document.removeEventListener(d,xt),ut.delete(d)):ut.set(d,p)}hr.delete(v),b!==r&&((g=b.parentNode)==null||g.removeChild(b))}});return kn.set(f,_),f}let kn=new WeakMap;function P(e,t,[r,a]=[0,0]){var s=e,l=null,o=null,u=Ee,v=r>0?Xt:0,f=!1;const _=(d,p=!0)=>{f=!0,b(p,d)},b=(d,p)=>{u!==(u=d)&&(u?(l?Bt(l):p&&(l=_t(()=>p(s))),o&&Ht(o,()=>{o=null})):(o?Bt(o):p&&(o=_t(()=>p(s,[r+1,a]))),l&&Ht(l,()=>{l=null})))};rr(()=>{f=!1,t(_),f||b(null,null)},v)}function bt(e,t){return t}function Cn(e,t,r,a){for(var s=[],l=t.length,o=0;o<l;o++)xr(t[o].e,s,!0);var u=l>0&&s.length===0&&r!==null;if(u){var v=r.parentNode;rn(v),v.append(r),a.clear(),Qe(e,t[0].prev,t[l-1].next)}ia(s,()=>{for(var f=0;f<l;f++){var _=t[f];u||(a.delete(_.k),Qe(e,_.prev,_.next)),Ke(_.e,!u)}})}function rt(e,t,r,a,s,l=null){var o=e,u={flags:t,items:new Map,first:null},v=(t&Gr)!==0;if(v){var f=e;o=f.appendChild(er())}var _=null,b=!1,d=Xa(()=>{var p=r();return pr(p)?p:p==null?[]:br(p)});rr(()=>{var p=n(d),g=p.length;b&&g===0||(b=g===0,Tn(p,u,o,s,t,a,r),l!==null&&(g===0?_?Bt(_):_=_t(()=>l(o)):_!==null&&Ht(_,()=>{_=null})),n(d))})}function Tn(e,t,r,a,s,l,o){var ce,O,M,K;var u=(s&za)!==0,v=(s&(yr|wr))!==0,f=e.length,_=t.items,b=t.first,d=b,p,g=null,E,I=[],R=[],A,j,y,w;if(u)for(w=0;w<f;w+=1)A=e[w],j=l(A,w),y=_.get(j),y!==void 0&&((ce=y.a)==null||ce.measure(),(E??(E=new Set)).add(y));for(w=0;w<f;w+=1){if(A=e[w],j=l(A,w),y=_.get(j),y===void 0){var T=d?d.e.nodes_start:r;g=On(T,t,g,g===null?t.first:g.next,A,j,w,a,s,o),_.set(j,g),I=[],R=[],d=g.next;continue}if(v&&Sn(y,A,w,s),(y.e.f&Ve)!==0&&(Bt(y.e),u&&((O=y.a)==null||O.unfix(),(E??(E=new Set)).delete(y))),y!==d){if(p!==void 0&&p.has(y)){if(I.length<R.length){var $=R[0],Y;g=$.prev;var H=I[0],B=I[I.length-1];for(Y=0;Y<I.length;Y+=1)$r(I[Y],$,r);for(Y=0;Y<R.length;Y+=1)p.delete(R[Y]);Qe(t,H.prev,B.next),Qe(t,g,H),Qe(t,B,$),d=$,g=B,w-=1,I=[],R=[]}else p.delete(y),$r(y,d,r),Qe(t,y.prev,y.next),Qe(t,y,g===null?t.first:g.next),Qe(t,g,y),g=y;continue}for(I=[],R=[];d!==null&&d.k!==j;)(d.e.f&Ve)===0&&(p??(p=new Set)).add(d),R.push(d),d=d.next;if(d===null)continue;y=d}I.push(y),g=y,d=y.next}if(d!==null||p!==void 0){for(var V=p===void 0?[]:br(p);d!==null;)(d.e.f&Ve)===0&&V.push(d),d=d.next;var re=V.length;if(re>0){var Z=(s&Gr)!==0&&f===0?r:null;if(u){for(w=0;w<re;w+=1)(M=V[w].a)==null||M.measure();for(w=0;w<re;w+=1)(K=V[w].a)==null||K.fix()}Cn(t,V,Z,_)}}u&&Er(()=>{var z;if(E!==void 0)for(y of E)(z=y.a)==null||z.apply()}),se.first=t.first&&t.first.e,se.last=g&&g.e}function Sn(e,t,r,a){(a&yr)!==0&&ur(e.v,t),(a&wr)!==0?ur(e.i,r):e.i=r}function On(e,t,r,a,s,l,o,u,v,f){var _=(v&yr)!==0,b=(v&Wa)===0,d=_?b?Kr(s):Wt(s):s,p=(v&wr)===0?o:Wt(o),g={i:p,v:d,k:l,a:null,e:null,prev:r,next:a};try{return g.e=_t(()=>u(e,d,p,f),en),g.e.prev=r&&r.e,g.e.next=a&&a.e,r===null?t.first=g:(r.next=g,r.e.next=g.e),a!==null&&(a.prev=g,a.e.prev=g.e),g}finally{}}function $r(e,t,r){for(var a=e.next?e.next.e.nodes_start:r,s=t?t.e.nodes_start:r,l=e.e.nodes_start;l!==a;){var o=tr(l);s.before(l),l=o}}function Qe(e,t,r){t===null?e.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function Tt(e,t,r=!1,a=!1,s=!1){var l=e,o="";G(()=>{var u=se;if(o!==(o=t()??"")&&(u.nodes_start!==null&&(sa(u.nodes_start,u.nodes_end),u.nodes_start=u.nodes_end=null),o!=="")){var v=o+"";r?v=`<svg>${v}</svg>`:a&&(v=`<math>${v}</math>`);var f=Cr(v);if((r||a)&&(f=Le(f)),pt(Le(f),f.lastChild),r||a)for(;Le(f);)l.before(Le(f));else l.before(f)}})}function St(e,t,...r){var a=e,s=Mt,l;rr(()=>{s!==(s=t())&&(l&&(Ke(l),l=null),l=_t(()=>s(a,...r)))},Xt)}const Nr=[...` 	
\r\f \v\uFEFF`];function An(e,t,r){var a=e==null?"":""+e;if(t&&(a=a?a+" "+t:t),r){for(var s in r)if(r[s])a=a?a+" "+s:s;else if(a.length)for(var l=s.length,o=0;(o=a.indexOf(s,o))>=0;){var u=o+l;(o===0||Nr.includes(a[o-1]))&&(u===a.length||Nr.includes(a[u]))?a=(o===0?"":a.substring(0,o))+a.substring(u+1):o=u}}return a===""?null:a}function Pn(e,t){return e==null?null:String(e)}function be(e,t,r,a,s,l){var o=e.__className;if(o!==r||o===void 0){var u=An(r,a,l);u==null?e.removeAttribute("class"):e.className=u,e.__className=r}else if(l&&s!==l)for(var v in l){var f=!!l[v];(s==null||f!==!!s[v])&&e.classList.toggle(v,f)}return l}function _r(e,t,r,a){var s=e.__style;if(s!==t){var l=Pn(t);l==null?e.removeAttribute("style"):e.style.cssText=l,e.__style=t}return a}const Rn=Symbol("is custom element"),qn=Symbol("is html");function Me(e,t,r,a){var s=Dn(e);s[t]!==(s[t]=r)&&(t==="loading"&&(e[Pa]=r),r==null?e.removeAttribute(t):typeof r!="string"&&$n(e).includes(t)?e[t]=r:e.setAttribute(t,r))}function Dn(e){return e.__attributes??(e.__attributes={[Rn]:e.nodeName.includes("-"),[qn]:e.namespaceURI===Ua})}var Ir=new Map;function $n(e){var t=Ir.get(e.nodeName);if(t)return t;Ir.set(e.nodeName,t=[]);for(var r,a=e,s=Element.prototype;s!==a;){r=Ea(a);for(var l in r)r[l].set&&t.push(l);a=zr(a)}return t}function qe(e,t,r=t){_a(e,"input",a=>{var s=a?e.defaultValue:e.value;if(s=cr(e)?vr(s):s,r(s),s!==(s=t())){var l=e.selectionStart,o=e.selectionEnd;e.value=s??"",o!==null&&(e.selectionStart=l,e.selectionEnd=Math.min(o,e.value.length))}}),Ct(t)==null&&e.value&&r(cr(e)?vr(e.value):e.value),ra(()=>{var a=t();cr(e)&&a===vr(e.value)||e.type==="date"&&!a&&!e.value||a!==e.value&&(e.value=a??"")})}function cr(e){var t=e.type;return t==="number"||t==="range"}function vr(e){return e===""?null:+e}function ba(e,t,r){if(e.multiple)return In(e,t);for(var a of e.options){var s=Et(a);if(Za(s,t)){a.selected=!0;return}}(!r||t!==void 0)&&(e.selectedIndex=-1)}function Nn(e,t){Ot(()=>{var r=new MutationObserver(()=>{var a=e.__value;ba(e,a)});return r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function ga(e,t,r=t){var a=!0;_a(e,"change",s=>{var l=s?"[selected]":":checked",o;if(e.multiple)o=[].map.call(e.querySelectorAll(l),Et);else{var u=e.querySelector(l)??e.querySelector("option:not([disabled])");o=u&&Et(u)}r(o)}),Ot(()=>{var s=t();if(ba(e,s,a),a&&s===void 0){var l=e.querySelector(":checked");l!==null&&(s=Et(l),r(s))}e.__value=s,a=!1}),Nn(e)}function In(e,t){for(var r of e.options)r.selected=~t.indexOf(Et(r))}function Et(e){return"__value"in e?e.__value:e.value}function jr(e,t){return e===t||(e==null?void 0:e[st])===t}function lr(e={},t,r,a){return Ot(()=>{var s,l;return ra(()=>{s=l,l=[],Ct(()=>{e!==r(...l)&&(t(e,...l),s&&jr(r(...s),e)&&t(null,...s))})}),()=>{Er(()=>{l&&jr(r(...l),e)&&t(null,...l)})}}),e}let Nt=!1;function jn(e){var t=Nt;try{return Nt=!1,[e(),Nt]}finally{Nt=t}}function Fr(e){var t;return((t=e.ctx)==null?void 0:t.d)??!1}function fe(e,t,r,a){var w;var s=(r&Ha)!==0,l=!0,o=(r&Ga)!==0,u=(r&Ja)!==0,v=!1,f;o?[f,v]=jn(()=>e[t]):f=e[t];var _=st in e||Aa in e,b=o&&(((w=ht(e,t))==null?void 0:w.set)??(_&&t in e&&(T=>e[t]=T)))||void 0,d=a,p=!0,g=!1,E=()=>(g=!0,p&&(p=!1,u?d=Ct(a):d=a),d);f===void 0&&a!==void 0&&(b&&l&&Ia(),f=E(),b&&b(f));var I;if(I=()=>{var T=e[t];return T===void 0?E():(p=!0,g=!1,T)},(r&Ba)===0)return I;if(b){var R=e.$$legacy;return function(T,$){return arguments.length>0?((!$||R||v)&&b($?I():T),T):I()}}var A=!1,j=Kr(f),y=Qt(()=>{var T=I(),$=n(j);return A?(A=!1,$):j.v=T});return o&&n(y),s||(y.equals=mr),function(T,$){if(arguments.length>0){const Y=$?n(y):o?me(T):T;if(!y.equals(Y)){if(A=!0,c(j,Y),g&&d!==void 0&&(d=Y),Fr(y))return T;Ct(()=>n(y))}return T}return Fr(y)?y.v:n(y)}}function ma(e){Ce===null&&Ka(),Ue(()=>{const t=Ct(e);if(typeof t=="function")return t})}const Fn="5";var Lr;typeof window<"u"&&((Lr=window.__svelte??(window.__svelte={})).v??(Lr.v=new Set)).add(Fn);var Mn=C('<div class="btn-spinner svelte-1230vvt"><div class="spinner-ring svelte-1230vvt"></div></div>'),Ln=C("<button><!> <span><!></span></button>");function ft(e,t){let r=fe(t,"variant",3,"primary"),a=fe(t,"size",3,"md"),s=fe(t,"disabled",3,!1),l=fe(t,"loading",3,!1),o=fe(t,"fullWidth",3,!1),u=fe(t,"glowing",3,!1),v=fe(t,"type",3,"button");const f=ze(()=>s()||l());var _=Ln();let b;_.__click=function(...R){var A;(A=t.onclick)==null||A.apply(this,R)};var d=i(_);{var p=R=>{var A=Mn();m(R,A)};P(d,R=>{l()&&R(p)})}var g=h(d,2);let E;var I=i(g);St(I,()=>t.children??Mt),G((R,A)=>{Me(_,"type",v()),b=be(_,1,`btn btn-${r()??""} btn-${a()??""}`,"svelte-1230vvt",b,R),_.disabled=n(f),E=be(g,1,"btn-content svelte-1230vvt",null,E,A)},[()=>({"btn-full":o(),"btn-loading":l(),"btn-glow":u()&&!n(f)}),()=>({"btn-content-hidden":l()})]),m(e,_)}Ie(["click"]);var zn=C('<div class="card-progress svelte-1g43p0q"><div class="card-progress-bar svelte-1g43p0q"></div></div>'),Wn=C('<div class="card-completion-indicator svelte-1g43p0q"><svg viewBox="0 0 20 20" fill="currentColor" class="svelte-1g43p0q"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" class="svelte-1g43p0q"></path></svg></div>'),Hn=C('<button type="button"><!> <!> <div class="card-content svelte-1g43p0q"><!></div></button>'),Bn=C('<div class="card-progress svelte-1g43p0q"><div class="card-progress-bar svelte-1g43p0q"></div></div>'),Gn=C('<div class="card-completion-indicator svelte-1g43p0q"><svg viewBox="0 0 20 20" fill="currentColor" class="svelte-1g43p0q"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" class="svelte-1g43p0q"></path></svg></div>'),Jn=C('<div><!> <!> <div class="card-content svelte-1g43p0q"><!></div></div>');function Ft(e,t){let r=fe(t,"variant",3,"default"),a=fe(t,"padding",3,"md"),s=fe(t,"glowing",3,!1),l=fe(t,"clickable",3,!1),o=fe(t,"completed",3,!1);const u=ze(()=>l()||!!t.onclick);var v=Ut(),f=$e(v);{var _=d=>{var p=Hn();let g;p.__click=function(...w){var T;(T=t.onclick)==null||T.apply(this,w)};var E=i(p);{var I=w=>{var T=zn(),$=i(T);G(()=>_r($,`width: ${t.progress??""}%`)),m(w,T)};P(E,w=>{t.progress!==void 0&&w(I)})}var R=h(E,2);{var A=w=>{var T=Wn();m(w,T)};P(R,w=>{o()&&w(A)})}var j=h(R,2),y=i(j);St(y,()=>t.children??Mt),G(w=>g=be(p,1,`card card-${r()??""} card-padding-${a()??""} card-clickable`,"svelte-1g43p0q",g,w),[()=>({"card-glow":s(),"card-completed":o()})]),m(d,p)},b=d=>{var p=Jn();let g;var E=i(p);{var I=w=>{var T=Bn(),$=i(T);G(()=>_r($,`width: ${t.progress??""}%`)),m(w,T)};P(E,w=>{t.progress!==void 0&&w(I)})}var R=h(E,2);{var A=w=>{var T=Gn();m(w,T)};P(R,w=>{o()&&w(A)})}var j=h(R,2),y=i(j);St(y,()=>t.children??Mt),G(w=>g=be(p,1,`card card-${r()??""} card-padding-${a()??""}`,"svelte-1g43p0q",g,w),[()=>({"card-glow":s(),"card-completed":o()})]),m(d,p)};P(f,d=>{n(u)?d(_):d(b,!1)})}m(e,v)}Ie(["click"]);var Yn=(e,t)=>e.key==="Escape"&&t(),Vn=e=>e.stopPropagation(),Un=e=>e.stopPropagation(),Kn=C('<span class="error-message svelte-lae1sa"> </span>'),Zn=C('<span class="error-message svelte-lae1sa"> </span>'),Xn=C("<option> </option>"),Qn=C('<form class="create-form svelte-lae1sa"><div class="modal-header svelte-lae1sa"><h2 class="modal-title svelte-lae1sa">Create New Project</h2> <button type="button" class="close-button svelte-lae1sa" aria-label="Close modal"><svg viewBox="0 0 20 20" fill="currentColor" class="svelte-lae1sa"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div> <div class="form-fields svelte-lae1sa"><div class="field-group svelte-lae1sa"><label for="title" class="field-label svelte-lae1sa">Project Title *</label> <input id="title" type="text" placeholder="Enter your book title" required> <!></div> <div class="field-group svelte-lae1sa"><label for="author" class="field-label svelte-lae1sa">Author *</label> <input id="author" type="text" placeholder="Your name" required> <!></div> <div class="field-group svelte-lae1sa"><label for="genre" class="field-label svelte-lae1sa">Genre</label> <select id="genre" class="field-input svelte-lae1sa"><option>Select a genre (optional)</option><!></select></div> <div class="field-group svelte-lae1sa"><label for="description" class="field-label svelte-lae1sa">Description</label> <textarea id="description" class="field-input field-textarea svelte-lae1sa" placeholder="Brief description of your book (optional)" rows="3"></textarea></div></div> <div class="modal-actions svelte-lae1sa"><!> <!></div></form>'),es=C('<div class="modal-overlay svelte-lae1sa" role="dialog" aria-modal="true"><div class="modal-container svelte-lae1sa"><!></div></div>');function ts(e,t){Be(t,!0);let r=F(me({title:"",author:"",genre:"",description:""})),a=F(!1),s=F(me({}));function l(){return c(s,{},!0),n(r).title.trim()||(n(s).title="Title is required"),n(r).author.trim()||(n(s).author="Author is required"),Object.keys(n(s)).length===0}async function o(){if(l()){c(a,!0);try{console.log("Creating project:",n(r)),alert(`Project "${n(r).title}" created successfully!`),u(),t.onClose()}catch{alert("Failed to create project. Please try again.")}finally{c(a,!1)}}}function u(){c(r,{title:"",author:"",genre:"",description:""},!0),c(s,{},!0)}function v(){t.onClose(),u()}const f=["Science Fiction","Fantasy","Mystery","Romance","Thriller","Horror","Historical Fiction","Contemporary Fiction","Young Adult","Literary Fiction","Adventure","Crime","Dystopian","Memoir"];var _=es();_.__click=v,_.__keydown=[Yn,v];var b=i(_);b.__click=[Vn],b.__keydown=[Un];var d=i(b);Ft(d,{variant:"highlighted",padding:"lg",children:(p,g)=>{var E=Qn(),I=i(E),R=h(i(I),2);R.__click=v;var A=h(I,2),j=i(A),y=h(i(j),2);let w;var T=h(y,2);{var $=D=>{var q=Kn(),S=i(q);G(()=>te(S,n(s).title)),m(D,q)};P(T,D=>{n(s).title&&D($)})}var Y=h(j,2),H=h(i(Y),2);let B;var V=h(H,2);{var re=D=>{var q=Zn(),S=i(q);G(()=>te(S,n(s).author)),m(D,q)};P(V,D=>{n(s).author&&D(re)})}var Z=h(Y,2),ce=h(i(Z),2),O=i(ce);O.value=O.__value="";var M=h(O);rt(M,17,()=>f,bt,(D,q)=>{var S=Xn(),W={},x=i(S);G(()=>{W!==(W=n(q))&&(S.value=(S.__value=n(q))??""),te(x,n(q))}),m(D,S)});var K=h(Z,2),z=h(i(K),2),k=h(A,2),N=i(k);ft(N,{variant:"ghost",onclick:v,get disabled(){return n(a)},children:(D,q)=>{var S=ke("Cancel");m(D,S)},$$slots:{default:!0}});var X=h(N,2);ft(X,{type:"submit",variant:"primary",get loading(){return n(a)},get disabled(){return n(a)},children:(D,q)=>{var S=ke("Create Project");m(D,S)},$$slots:{default:!0}}),G((D,q)=>{w=be(y,1,"field-input svelte-lae1sa",null,w,D),B=be(H,1,"field-input svelte-lae1sa",null,B,q)},[()=>({"field-error":n(s).title}),()=>({"field-error":n(s).author})]),sr("submit",E,D=>{D.preventDefault(),o()}),qe(y,()=>n(r).title,D=>n(r).title=D),qe(H,()=>n(r).author,D=>n(r).author=D),ga(ce,()=>n(r).genre,D=>n(r).genre=D),qe(z,()=>n(r).description,D=>n(r).description=D),m(p,E)},$$slots:{default:!0}}),m(e,_),Ge()}Ie(["click","keydown"]);var rs=wn('<svg viewBox="0 0 20 20" fill="currentColor" style="width: 1.25rem; height: 1.25rem;"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>'),as=C('<div class="journey-card svelte-gp5mqu"><div class="journey-card-header svelte-gp5mqu"><div class="journey-number svelte-gp5mqu"> </div> <h3 class="journey-title svelte-gp5mqu"> </h3></div> <p class="journey-description svelte-gp5mqu"> </p> <div class="journey-action svelte-gp5mqu"><!></div></div>'),ns=C(`<div class="about-section svelte-gp5mqu"><h3 class="about-title svelte-gp5mqu">About This Tool</h3> <p class="about-description svelte-gp5mqu">hypeWriter is an open-source tool that uses AI to help you write your book. All
            content is generated locally on your computer and saved in the book_output
            folder. You can edit, modify, and export your book at any time.</p> <div class="about-actions svelte-gp5mqu"><!> <!></div></div>`),ss=C('<div class="progress-item svelte-gp5mqu"><div class="progress-label svelte-gp5mqu"> </div> <div class="progress-bar-container svelte-gp5mqu"><div class="progress-bar svelte-gp5mqu"></div></div> <div class="progress-value svelte-gp5mqu"> </div></div>'),ls=C('<div class="progress-section svelte-gp5mqu"><h3 class="progress-title svelte-gp5mqu">Project Progress</h3> <div class="progress-grid svelte-gp5mqu"></div></div>'),is=C('<div class="dashboard svelte-gp5mqu"><header class="dashboard-header svelte-gp5mqu"><div class="header-content svelte-gp5mqu"><div class="header-info svelte-gp5mqu"><div class="header-title svelte-gp5mqu"><h1 class="svelte-gp5mqu">Welcome to hypeWriter</h1> <p class="svelte-gp5mqu">Create your book with AI assistance</p></div> <div class="current-project svelte-gp5mqu"><span class="project-label svelte-gp5mqu">workingTitle:</span> <span class="project-title svelte-gp5mqu">Sample Project</span> <br> <span class="project-label svelte-gp5mqu">currentAuthor:</span> <span class="project-author svelte-gp5mqu">Demo Author</span></div></div> <div class="header-actions svelte-gp5mqu"><div class="completion-badge svelte-gp5mqu"><span class="completion-text svelte-gp5mqu"> </span> <div class="completion-ring svelte-gp5mqu"><svg viewBox="0 0 42 42" class="completion-circle svelte-gp5mqu"><circle cx="21" cy="21" r="15.5" fill="transparent" stroke="rgba(255,255,255,0.2)" stroke-width="2"></circle><circle cx="21" cy="21" r="15.5" fill="transparent" stroke="var(--color-primary)" stroke-width="2" stroke-dashoffset="0" transform="rotate(-90 21 21)" class="progress-circle svelte-gp5mqu"></circle></svg> <span class="completion-percentage svelte-gp5mqu"> </span></div></div> <!></div></div></header> <main class="dashboard-main svelte-gp5mqu"><section class="journey-section svelte-gp5mqu"><h2 class="section-title svelte-gp5mqu">Your Writing Journey</h2> <div class="journey-grid svelte-gp5mqu"></div></section> <div class="bottom-section svelte-gp5mqu"><!> <!></div></main></div> <!>',1);function os(e,t){Be(t,!0);let r=F(!1),a=[{id:"world",number:1,title:"World Building",description:"Create your story's universe",action:"Edit World",completed:!1,progress:83},{id:"characters",number:2,title:"Characters",description:"Develop your cast",action:"Create Characters",completed:!1,progress:66},{id:"outline",number:3,title:"Outline",description:"Structure your story",action:"Create Outline",completed:!1,progress:47},{id:"chapters",number:4,title:"Chapters",description:"Write your story",action:"Start Writing",completed:!1,progress:6}],s=[{label:"World",value:83,color:"var(--color-primary)"},{label:"Characters",value:66,color:"var(--color-success)"},{label:"Synopsis",value:24,color:"var(--color-blue-light)"},{label:"Outline",value:47,color:"var(--color-cyan-medium)"},{label:"Chapter",value:6,color:"var(--color-blue-primary)"},{label:"Content",value:11,color:"var(--color-green-accent)"}];ma(()=>{});function l(O){window.location.href=`/${O}`}function o(){c(r,!0)}function u(){alert("Import functionality coming soon!")}const v=ze(()=>Math.round(a.reduce((O,M)=>O+M.progress,0)/a.length));var f=is(),_=$e(f),b=i(_),d=i(b),p=h(i(d),2),g=i(p),E=i(g),I=i(E),R=h(E,2),A=i(R),j=h(i(A)),y=h(A,2),w=i(y),T=h(g,2);ft(T,{variant:"ghost",size:"sm",children:(O,M)=>{var K=rs();m(O,K)},$$slots:{default:!0}});var $=h(b,2),Y=i($),H=h(i(Y),2);rt(H,21,()=>a,bt,(O,M)=>{Ft(O,{variant:"journey",clickable:!0,get completed(){return n(M).completed},get progress(){return n(M).progress},onclick:()=>l(n(M).id),children:(K,z)=>{var k=as(),N=i(k),X=i(N),D=i(X),q=h(X,2),S=i(q),W=h(N,2),x=i(W),L=h(W,2),J=i(L);ft(J,{variant:"primary",fullWidth:!0,children:(ae,ee)=>{var U=ke();G(()=>te(U,n(M).action)),m(ae,U)},$$slots:{default:!0}}),G(()=>{te(D,n(M).number),te(S,n(M).title),te(x,n(M).description)}),m(K,k)},$$slots:{default:!0}})});var B=h(Y,2),V=i(B);Ft(V,{variant:"default",padding:"lg",children:(O,M)=>{var K=ns(),z=h(i(K),4),k=i(z);ft(k,{variant:"outline",onclick:o,children:(X,D)=>{var q=ke("New Project");m(X,q)},$$slots:{default:!0}});var N=h(k,2);ft(N,{variant:"secondary",onclick:u,children:(X,D)=>{var q=ke("Import Story");m(X,q)},$$slots:{default:!0}}),m(O,K)},$$slots:{default:!0}});var re=h(V,2);Ft(re,{variant:"default",padding:"lg",children:(O,M)=>{var K=ls(),z=h(i(K),2);rt(z,21,()=>s,bt,(k,N)=>{var X=ss(),D=i(X),q=i(D),S=h(D,2),W=i(S),x=h(S,2),L=i(x);G(()=>{te(q,n(N).label),_r(W,`width: ${n(N).value??""}%; background-color: ${n(N).color??""}`),te(L,`${n(N).value??""}%`)}),m(k,X)}),m(O,K)},$$slots:{default:!0}});var Z=h(_,2);{var ce=O=>{ts(O,{onClose:()=>c(r,!1)})};P(Z,O=>{n(r)&&O(ce)})}G(()=>{te(I,`${n(v)??""}% Complete`),Me(j,"stroke-dasharray",`${n(v)/100*97.4} 97.4`),te(w,`${n(v)??""}%`)}),m(e,f),Ge()}var cs=(e,t)=>t("/"),vs=(e,t)=>t("/world"),ds=(e,t)=>t("/characters"),us=(e,t)=>t("/outline"),fs=(e,t)=>t("/chapters"),hs=C("<nav><ul><li><button>Home</button></li> <li><button>World</button></li> <li><button>Characters</button></li> <li><button>Outline</button></li> <li><button>Chapters</button></li></ul></nav>");function _s(e,t){Be(t,!0);function r(y){history.pushState({},"",y),window.dispatchEvent(new PopStateEvent("popstate"))}var a=hs(),s=i(a),l=i(s);let o;var u=i(l);u.__click=[cs,r];var v=h(l,2);let f;var _=i(v);_.__click=[vs,r];var b=h(v,2);let d;var p=i(b);p.__click=[ds,r];var g=h(b,2);let E;var I=i(g);I.__click=[us,r];var R=h(g,2);let A;var j=i(R);j.__click=[fs,r],G((y,w,T,$,Y)=>{o=be(l,1,"",null,o,y),f=be(v,1,"",null,f,w),d=be(b,1,"",null,d,T),E=be(g,1,"",null,E,$),A=be(R,1,"",null,A,Y)},[()=>({active:t.currentPath==="/"}),()=>({active:t.currentPath==="/world"}),()=>({active:t.currentPath==="/characters"}),()=>({active:t.currentPath==="/outline"}),()=>({active:t.currentPath==="/chapters"})]),m(e,a),Ge()}Ie(["click"]);Ie(["click"]);var ps=C('<div><div class="content svelte-1ur1bpy"><!></div></div>'),bs=C('<div class="typing-indicator svelte-1ur1bpy"><div class="spinner svelte-1ur1bpy"></div> <span class="svelte-1ur1bpy">AI is thinking...</span></div>'),gs=(e,t)=>e.key==="Enter"&&!e.shiftKey&&t(),ms=C('<div class="chat-container svelte-1ur1bpy"><!> <div id="chatMessages" class="chat-messages-area p-3 mb-3 border rounded svelte-1ur1bpy"><!> <!></div> <div class="input-container d-flex svelte-1ur1bpy"><textarea class="form-control me-2 svelte-1ur1bpy"></textarea> <button class="send-button btn btn-primary svelte-1ur1bpy"> </button></div> <div class="mt-3 text-center svelte-1ur1bpy"><!></div></div>');function ys(e,t){Be(t,!0);let r=fe(t,"chatHistory",15),a=fe(t,"contextData",19,()=>({})),s=fe(t,"placeholderText",3,"Type your message..."),l=fe(t,"isGenerating",15,!1),o=fe(t,"topic",15,""),u=F(""),v;Ue(()=>{v&&(v.scrollTop=v.scrollHeight)});async function f(){const H=n(u).trim();if(!H||l())return;c(u,""),l(!0),r([...r(),{role:"user",content:H}]),!o()&&r().filter(Z=>Z.role==="user").length===1&&(o(H.split(" ").slice(0,5).join(" ")),console.log("Derived topic:",o()));let B=r().length;r([...r(),{role:"assistant",content:'<span class="typing-cursor">▌</span>'}]),r([...r()]);const V={message:H,chat_history:r().slice(0,B),...a(),topic:o()};let re="";try{const Z=await fetch(t.chatEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V)});if(!Z.ok||!Z.body){const M=await Z.json().catch(()=>({detail:"Unknown error"}));throw new Error(`Chat stream request failed: ${Z.status} ${Z.statusText} - ${M.detail}`)}const ce=Z.body.getReader(),O=new TextDecoder;for(r()[B]?(r(r()[B].content="",!0),r([...r()])):(r([...r(),{role:"assistant",content:""}]),B=r().length-1,r([...r()]));;){const{done:M,value:K}=await ce.read();if(M)break;O.decode(K).split(`

`).filter(Boolean).forEach(k=>{if(k.startsWith("data: "))try{const N=k.substring(6);if(N==="[DONE]")return;const X=JSON.parse(N);X.content!==void 0&&(re+=X.content,r()[B]&&(r(r()[B].content=_(re)+'<span class="typing-cursor">▌</span>',!0),r([...r()])))}catch(N){console.error("Error parsing SSE data line:",N,jsonData),r()[B]&&(r(r()[B].content=_(re)+` [Parsing Error: ${N.message}]<span class="typing-cursor">▌</span>`,!0),r([...r()]))}})}r()[B]&&(r(r()[B].content=_(re),!0),r([...r()]))}catch(Z){console.error("Chat stream fetch error:",Z),r()[B]?(r(r()[B].content=_(re)+` [Error: ${Z.message}]`,!0),r([...r()])):(r([...r(),{role:"system",content:`Error communicating with AI: ${Z.message}. Please check the console.`}]),r([...r()]))}finally{l(!1)}}function _(H){return H.replace(/\n{2,}/g,"<br><br>").replace(/\n/g,"<br>")}var b=ms(),d=i(b);{var p=H=>{var B=Ut(),V=$e(B);St(V,()=>t.introText),m(H,B)};P(d,H=>{t.introText&&H(p)})}var g=h(d,2),E=i(g);rt(E,17,r,bt,(H,B)=>{var V=ps(),re=i(V),Z=i(re);Tt(Z,()=>_(n(B).content)),G(()=>be(V,1,`message ${n(B).role??""}`,"svelte-1ur1bpy")),m(H,V)});var I=h(E,2);{var R=H=>{var B=bs();m(H,B)};P(I,H=>{l()&&H(R)})}lr(g,H=>v=H,()=>v);var A=h(g,2),j=i(A);j.__keydown=[gs,f];var y=h(j,2);y.__click=f;var w=i(y),T=h(A,2),$=i(T);{var Y=H=>{var B=Ut(),V=$e(B);St(V,()=>t.belowInput),m(H,B)};P($,H=>{t.belowInput&&H(Y)})}G(H=>{Me(j,"placeholder",s()),j.disabled=l(),y.disabled=H,te(w,l()?"...":"Send")},[()=>l()||!n(u).trim()]),qe(j,()=>n(u),H=>c(u,H)),m(e,b),Ge()}Ie(["keydown","click"]);var ws=(e,t)=>t("/characters"),xs=C("<p>Current Topic: <strong> </strong></p>"),Es=C('<div class="alert alert-danger mt-3" role="alert"> </div>'),ks=C('<div class="col-12 mb-4"><div class="alert alert-info d-flex align-items-center" role="status"><div class="spinner-border spinner-border-sm me-2" aria-hidden="true"></div> Loading world data...</div></div>'),Cs=C('<div class="col-12 mb-4"><div class="alert alert-danger mt-3" role="alert"> </div></div>'),Ts=C('<div class="alert alert-info mt-3"><div class="d-flex align-items-center"><div class="spinner-border spinner-border-sm me-2" role="status"><span class="visually-hidden">Loading...</span></div> <div>AI is thinking...</div></div></div>'),Ss=C('<button class="btn btn-success mt-3 svelte-tn3u0s">Finalize World Setting</button> <!>',1),Os=C('<div class="col-12 mb-4"><div class="card svelte-tn3u0s"><div class="card-header bg-primary text-white"><h2 class="h5 mb-0">World Building Chat</h2></div> <div class="card-body"><!></div></div></div>'),As=(e,t)=>t("/characters"),Ps=C('<div class="alert alert-info mt-3"><div class="d-flex align-items-center"><div class="spinner-border spinner-border-sm me-2" role="status"><span class="visually-hidden">Saving...</span></div> <div>Saving changes...</div></div></div>'),Rs=C('<div class="alert alert-success mt-3"><div>World setting saved successfully!</div></div>'),qs=C('<div class="col-12"><div class="card svelte-tn3u0s"><div class="card-header bg-success text-white"><h2 class="h5 mb-0">Your World Setting</h2></div> <div class="card-body"><form><div class="mb-3"><label for="worldTheme" class="form-label">Edit your world setting if needed:</label> <textarea class="form-control" id="worldTheme" name="world_theme" rows="12"></textarea></div> <div class="d-flex justify-content-between"><button type="submit" class="btn btn-success svelte-tn3u0s">Save Changes</button> <button class="btn btn-primary svelte-tn3u0s">Continue to Characters</button></div></form> <!> <!></div></div></div>'),Ds=C(`<div class="world-container svelte-tn3u0s"><div class="row"><div class="col-12 mb-4"><div class="card svelte-tn3u0s"><div class="card-header bg-primary text-white d-flex justify-content-between align-items-center"><h1 class="h4 mb-0">Create World Setting</h1> <button class="btn btn-light btn-sm svelte-tn3u0s">Next: Characters &raquo;</button></div> <div class="card-body svelte-tn3u0s"><p class="lead svelte-tn3u0s">Start by chatting with the AI to develop your book's world. Describe your ideas, answer
						questions, and explore different aspects of your world together.</p> <!> <!></div></div></div> <!> <!> <!> <!></div></div>`);function $s(e,t){Be(t,!0);let r=fe(t,"initial_world_theme",3,""),a=fe(t,"initial_topic",3,""),s=F(me([])),l=F(""),o=F(me(a()||"")),u=F(!0),v=F(null),f=F(!1),_=F(!1),b=F(null),d=F(!0),p=F(!1),g=ze(()=>n(s).filter(S=>S.role==="user").length===0||n(u)||n(p)),E=ze(()=>!n(u)&&n(l).length>0),I;const R="Tell me about the world you want to create for your book. What kind of setting, time period, or genre are you interested in?";Ue(()=>{async function S(){c(u,!0),c(v,null),c(d,!0);try{const W=await fetch("/api/world");if(!W.ok){const L=await W.text();throw new Error(`HTTP error! status: ${W.status}: ${L}`)}const x=await W.json();c(l,x.world_theme||r(),!0),c(o,x.topic||a(),!0),n(l)?c(s,[{role:"system",content:"Loaded existing World Setting:"},{role:"assistant",content:n(l)}],!0):c(s,[{role:"assistant",content:R}],!0)}catch(W){console.error("Error loading initial world data:",W),c(v,`Failed to load initial data: ${W.message}`),c(l,r()),c(o,a()),c(s,[{role:"system",content:`Error loading previous world data: ${W.message}`},{role:"assistant",content:R}],!0)}finally{c(u,!1),c(d,!n(E))}}S()}),Ue(()=>{!n(f)&&!n(u)&&n(E)?c(d,!1):n(E)||c(d,!0)});async function A(){if(n(s).filter(J=>J.role==="user").length===0){alert("Please send at least one message to the AI before finalizing.");return}if(n(g))return;c(l,""),c(b,null);const S={chat_history:n(s),topic:n(o)};let W="",x=new AbortController,L=x.signal;c(p,!0);try{const J=await fetch("/finalize_world_stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S),signal:L});if(!J.ok||!J.body){const U=await J.text();throw new Error(`HTTP error! status: ${J.status}: ${U}`)}const ae=J.body.getReader(),ee=new TextDecoder;for(;;){const{value:U,done:ie}=await ae.read();if(ie||(ee.decode(U).split(`

`).filter(Boolean).forEach(de=>{if(de.includes("[STREAMING ERROR: ")){console.error("Received streaming error:",de),c(b,`AI streaming error: ${de.substring(de.indexOf("[STREAMING ERROR: "))}`),c(p,!1),x.abort();return}if(de.startsWith("data: "))try{const ue=de.substring(6);if(ue==="[DONE]")return;const he=JSON.parse(ue);he.content!==void 0&&(W+=he.content,c(l,W,!0))}catch(ue){console.error("Error parsing JSON from finalize stream:",ue,jsonData),c(l,n(l)+` [Parsing Error: ${ue.message}]`),c(b,"Failed to parse AI response chunk.")}}),L.aborted))break}}catch(J){J.name==="AbortError"?console.log("Fetch aborted due to streaming error."):(console.error("Fetch or stream reading error for final world setting:",J),c(b,`Error finalizing world setting: ${J.message}`),n(l).includes("Error finalizing world setting:")||c(l,`Error finalizing world setting: ${J.message}

`+n(l)))}finally{n(b)||c(p,!1)}}async function j(S){if(S.preventDefault(),n(d))return;c(f,!0),c(_,!1),c(b,null),c(d,!0);const W={world_theme:n(l)};try{const x=await fetch("/save_world",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)});if(!x.ok){const L=await x.text();throw new Error(`HTTP error! status: ${x.status}: ${L}`)}c(f,!1),c(_,!0),setTimeout(()=>{c(_,!1)},3e3)}catch(x){console.error("Error saving world theme:",x),c(b,`Error saving world theme: ${x.message}`),c(f,!1),c(d,!1)}}function y(S){history.pushState(null,"",S),window.dispatchEvent(new PopStateEvent("popstate"))}var w=Ds(),T=i(w),$=i(T),Y=i($),H=i(Y),B=h(i(H),2);B.__click=[ws,y];var V=h(H,2),re=h(i(V),2);{var Z=S=>{var W=xs(),x=h(i(W)),L=i(x);G(()=>te(L,n(o))),m(S,W)};P(re,S=>{n(o)&&S(Z)})}var ce=h(re,2);{var O=S=>{var W=Es(),x=i(W);G(()=>te(x,n(v))),m(S,W)};P(ce,S=>{n(v)&&S(O)})}var M=h($,2);{var K=S=>{var W=ks();m(S,W)};P(M,S=>{n(u)&&S(K)})}var z=h(M,2);{var k=S=>{var W=Cs(),x=i(W),L=i(x);G(()=>te(L,n(b))),m(S,W)};P(z,S=>{n(b)&&S(k)})}var N=h(z,2);{var X=S=>{var W=Os(),x=i(W),L=h(i(x),2),J=i(L);ys(J,{chatEndpoint:"/world_chat_stream",contextData:{},placeholderText:"Type your ideas about the world you want to create...",get chatHistory(){return n(s)},set chatHistory(U){c(s,U,!0)},get isGenerating(){return n(p)},set isGenerating(U){c(p,U,!0)},get topic(){return n(o)},set topic(U){c(o,U,!0)},introText:U=>{},belowInput:U=>{var ie=Ss(),ge=$e(ie);ge.__click=A;var de=h(ge,2);{var ue=he=>{var je=Ts();m(he,je)};P(de,he=>{n(p)&&he(ue)})}G(()=>ge.disabled=n(g)),m(U,ie)},$$slots:{introText:!0,belowInput:!0}}),m(S,W)};P(N,S=>{!n(E)&&!n(u)&&S(X)})}var D=h(N,2);{var q=S=>{var W=qs(),x=i(W),L=h(i(x),2),J=i(L),ae=i(J),ee=h(i(ae),2);lr(ee,_e=>I=_e,()=>I);var U=h(ae,2),ie=i(U),ge=h(ie,2);ge.__click=[As,y];var de=h(J,2);{var ue=_e=>{var Je=Ps();m(_e,Je)};P(de,_e=>{n(f)&&_e(ue)})}var he=h(de,2);{var je=_e=>{var Je=Rs();m(_e,Je)};P(he,_e=>{n(_)&&_e(je)})}G(()=>{ie.disabled=n(d),ge.disabled=!n(l)||n(f)||n(u)||n(p)}),sr("submit",J,j),qe(ee,()=>n(l),_e=>c(l,_e)),m(S,W)};P(D,S=>{n(E)&&S(q)})}G(()=>B.disabled=!n(l)||n(f)||n(u)||n(p)),m(e,w),Ge()}Ie(["click"]);async function Ns(e,t,r,a,s,l,o,u,v,f){if(n(t).filter(p=>p.role==="user").length===0){alert("Please send at least one message to the AI before finalizing.");return}if(n(r))return;c(a,!0),c(s,""),c(l,""),c(o,null);const _={chat_history:n(t),world_theme:n(u),num_characters:n(v)};let b=new AbortController,d=b.signal;try{const p=await fetch("/finalize_characters_stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_),signal:d});if(!p.ok||!p.body){const R=await p.text();throw new Error(`HTTP error! status: ${p.status}: ${R}`)}const g=p.body.getReader(),E=new TextDecoder;let I="";for(;;){const{value:R,done:A}=await g.read();if(A||(E.decode(R).split(`

`).filter(Boolean).forEach(y=>{if(y.includes("[STREAMING ERROR: ")){console.error("Received streaming error:",y),c(o,`AI streaming error: ${y.substring(y.indexOf("[STREAMING ERROR: "))}`),c(a,!1),b.abort();return}if(y.startsWith("data: "))try{const w=y.substring(6);if(w==="[DONE]")return;const T=JSON.parse(w);T.content!==void 0&&(I+=T.content,c(l,I,!0))}catch(w){console.error("Error parsing JSON from finalize stream:",w,jsonData),c(l,n(l)+` [Parsing Error: ${w.message}]`),c(o,"Failed to parse AI response chunk during finalization.")}}),d.aborted))break}c(f,!0)}catch(p){p.name==="AbortError"?console.log("Fetch aborted due to streaming error."):(console.error("Fetch error for final characters:",p),c(o,`Error finalizing characters: ${p.message}`),c(l,`Error finalizing characters: ${p.message}

`+n(l)),c(f,!0))}finally{n(o)||c(a,!1)}}async function Is(e,t){const r={characters:n(t)};try{const a=await fetch("/save_characters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){const s=await a.text();throw new Error(`HTTP error! status: ${a.status}: ${s}`)}alert("Characters saved successfully!")}catch(a){console.error("Error saving characters:",a),alert(`Failed to save characters: ${a.message}`)}}var js=C('<a href="/outline" class="btn btn-light svelte-1ibv7hy">Next: Outline &raquo;</a>'),Fs=C('<div class="col-12 mb-4 svelte-1ibv7hy"><div class="alert alert-warning svelte-1ibv7hy"><strong class="svelte-1ibv7hy">Context needed!</strong> Please ensure you have set your <a href="/world" class="alert-link svelte-1ibv7hy">World Setting</a> before developing characters.</div></div>'),Ms=C('<div class="col-12 mb-4 svelte-1ibv7hy"><div class="alert alert-danger mt-3 svelte-1ibv7hy" role="alert"> </div></div>'),Ls=(e,t)=>c(t,!n(t)),zs=C('<div class="full-world mt-2 pt-2 border-top svelte-1ibv7hy"><p class="svelte-1ibv7hy"> </p></div>'),Ws=C('<div><div class="content svelte-1ibv7hy"><!></div></div>'),Hs=C('<div class="message assistant svelte-1ibv7hy"><div class="content svelte-1ibv7hy"><!><span class="typing-cursor svelte-1ibv7hy">|</span></div></div>'),Bs=C('<div class="typing-indicator svelte-1ibv7hy"><div class="spinner svelte-1ibv7hy"></div> <span class="svelte-1ibv7hy">AI is thinking...</span></div>'),Gs=C(`<div class="mb-3 svelte-1ibv7hy"><label for="numCharacters" class="form-label svelte-1ibv7hy">Approximate number of main characters to generate:</label> <input type="number" id="numCharacters" class="form-control svelte-1ibv7hy" min="1" max="20" step="1"></div> <div class="card chat-card svelte-1ibv7hy"><div class="card-header bg-primary text-white svelte-1ibv7hy"><h3 class="h5 mb-0 svelte-1ibv7hy">Character Building Chat</h3></div> <div class="chat-container card-body svelte-1ibv7hy"><p class="lead svelte-1ibv7hy">Chat here to brainstorm ideas for your characters. When you're ready, click
								"Finalize Characters" to generate structured character descriptions based on the
								conversation.</p> <div class="chat-messages-area svelte-1ibv7hy"><!> <!> <!></div> <div class="input-container d-flex svelte-1ibv7hy"><textarea class="form-control svelte-1ibv7hy" placeholder="Describe a character or type your ideas..." rows="1"></textarea> <button class="btn btn-primary ms-2 svelte-1ibv7hy">Send</button></div> <div class="mt-3 text-center svelte-1ibv7hy"><button class="btn btn-success svelte-1ibv7hy">Finalize Characters</button></div></div></div>`,1),Js=C('<div class="card results-card svelte-1ibv7hy"><div class="card-header bg-success text-white svelte-1ibv7hy"><h3 class="h5 mb-0 svelte-1ibv7hy">Your Characters</h3></div> <div class="card-body svelte-1ibv7hy"><p class="lead svelte-1ibv7hy">Here are the generated character descriptions. You can edit them directly.</p> <div class="form-group mb-3 svelte-1ibv7hy"><label for="charactersContent" class="form-label svelte-1ibv7hy">Edit your characters:</label> <textarea id="charactersContent" rows="15" class="form-control svelte-1ibv7hy"></textarea></div> <div class="d-flex justify-content-between svelte-1ibv7hy"><button class="save-button btn btn-success svelte-1ibv7hy">Save Characters</button> <a href="/outline" class="btn btn-primary svelte-1ibv7hy">Continue to Outline</a></div></div></div>'),Ys=C('<div class="col-12 svelte-1ibv7hy"><div class="world-context mb-4 svelte-1ibv7hy"><h3 class="svelte-1ibv7hy">World Setting Context:</h3> <div class="context-card card bg-light svelte-1ibv7hy"><div class="card-body svelte-1ibv7hy"><p class="card-text small mb-0 svelte-1ibv7hy"> </p> <button class="btn btn-link btn-sm p-0 svelte-1ibv7hy"> </button> <!></div></div></div> <!></div>'),Vs=C(`<div class="characters-container svelte-1ibv7hy"><div class="row svelte-1ibv7hy"><div class="col-12 mb-4 svelte-1ibv7hy"><div class="card svelte-1ibv7hy"><div class="card-header bg-primary text-white d-flex justify-content-between align-items-center svelte-1ibv7hy"><h1 class="h4 mb-0 svelte-1ibv7hy">Develop Characters</h1> <div class="navigation-buttons svelte-1ibv7hy"><a href="/world" class="btn btn-light svelte-1ibv7hy">&laquo; Previous: World</a> <!></div></div> <div class="card-body svelte-1ibv7hy"><p class="lead svelte-1ibv7hy">Chat with the AI to brainstorm and develop your book's characters. Define their roles,
						personalities, and backstories.</p></div></div></div> <!> <!> <!></div></div>`);function Us(e,t){Be(t,!0);let r=F(""),a=F(""),s=F(me([])),l=F(!1),o=F(5),u=F(!1),v=F(""),f=F(!1),_=F(""),b=F(null),d=null;Ue(()=>{d&&(d.scrollTop=d.scrollHeight)});async function p(){if(!n(v).trim()||n(f))return;const O={role:"user",content:n(v)};c(s,[...n(s),O],!0),c(v,""),c(f,!0),c(_,""),c(b,null);const M={chat_history:n(s),world_theme:n(a),num_characters:n(o)};let K=new AbortController,z=K.signal;try{const k=await fetch("/characters_chat_stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(M),signal:z});if(!k.ok||!k.body){const q=await k.text();throw new Error(`HTTP error! status: ${k.status}: ${q}`)}const N=k.body.getReader(),X=new TextDecoder;let D="";for(;;){const{value:q,done:S}=await N.read();if(S||(X.decode(q).split(`

`).filter(Boolean).forEach(x=>{if(x.includes("[STREAMING ERROR: ")){console.error("Received streaming error:",x),c(b,`AI streaming error: ${x.substring(x.indexOf("[STREAMING ERROR: "))}`),c(f,!1),K.abort();return}if(x.startsWith("data: "))try{const L=x.substring(6);if(L==="[DONE]")return;const J=JSON.parse(L);J.content!==void 0&&(D+=J.content,c(_,D,!0))}catch(L){console.error("Error parsing JSON from stream:",L,jsonData),c(b,"Failed to parse AI response chunk.")}}),z.aborted))break}n(b)||c(s,[...n(s),{role:"assistant",content:D}],!0)}catch(k){k.name==="AbortError"?console.log("Fetch aborted due to streaming error."):(console.error("Fetch or stream reading error for chat stream:",k),c(b,`Fetch or stream error: ${k.message}`),c(s,[...n(s),{role:"system",content:`Error: ${k.message}`}],!0))}finally{n(b)||(c(f,!1),c(_,""))}}function g(O){return O.split(`

`).map(M=>M.startsWith("```")?`<pre><code>${M.substring(3).replace("```","")}</code></pre>`:`<p>${M}</p>`).join("")}let E=ze(()=>n(s).filter(O=>O.role==="user").length===0||n(f));const I="Based on your world setting, what kind of characters are you thinking of? You can describe individuals, archetypes, or groups. I can help you brainstorm or generate character concepts.";Ue(()=>{async function O(){try{const M=await fetch("/api/world");if(!M.ok)throw new Error("Failed to fetch world data");const K=await M.json();c(a,K.world_theme||"No world theme set.",!0);const z=await fetch("/api/characters");if(!z.ok)c(s,[{role:"assistant",content:I}],!0),c(u,!1);else{const k=await z.json();c(r,k.characters||"",!0),n(r)?c(u,!0):(c(s,[{role:"assistant",content:I}],!0),c(u,!1))}}catch(M){console.error("Error loading context data:",M),c(s,[{role:"system",content:`Error loading context data: ${M.message}`},{role:"assistant",content:I}],!0),c(u,!1)}}O()});var R=Vs(),A=i(R),j=i(A),y=i(j),w=i(y),T=h(i(w),2),$=h(i(T),2);{var Y=O=>{var M=js();m(O,M)};P($,O=>{n(r)&&O(Y)})}var H=h(j,2);{var B=O=>{var M=Fs();m(O,M)};P(H,O=>{n(a)||O(B)})}var V=h(H,2);{var re=O=>{var M=Ms(),K=i(M),z=i(K);G(()=>te(z,n(b))),m(O,M)};P(V,O=>{n(b)&&O(re)})}var Z=h(V,2);{var ce=O=>{var M=Ys(),K=i(M),z=h(i(K),2),k=i(z),N=i(k),X=i(N),D=h(N,2);D.__click=[Ls,l];var q=i(D),S=h(D,2);{var W=ae=>{var ee=zs(),U=i(ee),ie=i(U);G(()=>te(ie,n(a))),m(ae,ee)};P(S,ae=>{n(l)&&ae(W)})}var x=h(K,2);{var L=ae=>{var ee=Gs(),U=$e(ee),ie=h(i(U),2),ge=h(U,2),de=h(i(ge),2),ue=h(i(de),2),he=i(ue);rt(he,17,()=>n(s),Q=>Q.role+Q.content,(Q,pe)=>{var Se=Ws(),Xe=i(Se),vt=i(Xe);Tt(vt,()=>g(n(pe).content)),G(()=>be(Se,1,`message ${n(pe).role??""}`,"svelte-1ibv7hy")),m(Q,Se)});var je=h(he,2);{var _e=Q=>{var pe=Hs(),Se=i(pe),Xe=i(Se);Tt(Xe,()=>g(n(_))),m(Q,pe)};P(je,Q=>{n(_)&&Q(_e)})}var Je=h(je,2);{var ot=Q=>{var pe=Bs();m(Q,pe)};P(Je,Q=>{n(f)&&!n(_)&&Q(ot)})}lr(ue,Q=>d=Q,()=>d);var ct=h(ue,2),ye=i(ct),Pe=h(ye,2);Pe.__click=p;var le=h(ct,2),ve=i(le);ve.__click=[Ns,s,E,f,_,r,b,a,o,u],G(()=>{ye.disabled=n(f),Pe.disabled=n(f),ve.disabled=n(E)}),qe(ie,()=>n(o),Q=>c(o,Q)),sr("keypress",ye,Q=>{Q.key==="Enter"&&!Q.shiftKey&&(Q.preventDefault(),p())}),qe(ye,()=>n(v),Q=>c(v,Q)),m(ae,ee)},J=ae=>{var ee=Js(),U=h(i(ee),2),ie=h(i(U),2),ge=h(i(ie),2),de=h(ie,2),ue=i(de);ue.__click=[Is,r],qe(ge,()=>n(r),he=>c(r,he)),m(ae,ee)};P(x,ae=>{n(u)?ae(J,!1):ae(L)})}G(ae=>{te(X,ae),te(q,n(l)?"Show less":"Show more")},[()=>n(l)?n(a):n(a).substring(0,200)+"..."]),m(O,M)};P(Z,O=>{n(a)&&O(ce)})}m(e,R),Ge()}Ie(["click"]);async function Ks(e,t,r,a,s,l,o,u,v,f,_,b){if(n(t).filter(E=>E.role==="user").length===0){alert("Please send at least one message to the AI before finalizing.");return}if(n(r))return;c(a,!0),c(s,""),c(l,""),c(o,null);const d={chat_history:n(t),world_theme:n(u),characters:n(v),num_chapters:n(f)};let p=new AbortController,g=p.signal;try{const E=await fetch("/finalize_outline_stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),signal:g});if(!E.ok||!E.body){const j=await E.text();throw new Error(`HTTP error! status: ${E.status}: ${j}`)}const I=E.body.getReader(),R=new TextDecoder;let A="";for(;;){const{value:j,done:y}=await I.read();if(y||(R.decode(j).split(`

`).filter(Boolean).forEach(T=>{if(T.includes("[STREAMING ERROR: ")){console.error("Received streaming error:",T),c(o,`AI streaming error: ${T.substring(T.indexOf("[STREAMING ERROR: "))}`),c(l,`Error finalizing outline: ${n(o)}

`+n(l)),c(a,!1),p.abort();return}if(T.startsWith("data: "))try{const $=T.substring(6);if($==="[DONE]")return;const Y=JSON.parse($);Y.content!==void 0&&(A+=Y.content,c(l,A,!0))}catch($){console.error("Error parsing JSON from finalize stream:",$,jsonData),c(l,n(l)+` [Parsing Error: ${$.message}]`),c(o,"Failed to parse AI response chunk during finalization.")}}),g.aborted))break}c(b,!0)}catch(E){E.name==="AbortError"?console.log("Fetch aborted due to streaming error."):(console.error("Fetch error for final outline:",E),c(o,`Error finalizing outline: ${E.message}`),c(l,`Error finalizing outline: ${E.message}

`+n(l)),c(b,!0))}finally{n(o)||(c(a,!1),c(s,""))}}async function Zs(e,t){const r={outline:n(t)};try{const a=await fetch("/save_outline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){const s=await a.text();throw new Error(`HTTP error! status: ${a.status}: ${s}`)}alert("Outline saved successfully!")}catch(a){console.error("Error saving outline:",a),alert(`Failed to save outline: ${a.message}`)}}var Xs=C('<a href="/chapters" class="btn btn-light svelte-ne31rl">Next: Chapters &raquo;</a>'),Qs=C('<div class="col-12 mb-4 svelte-ne31rl"><div class="alert alert-warning svelte-ne31rl"><strong class="svelte-ne31rl">Context needed!</strong> Please ensure you have set your <a href="/world" class="alert-link svelte-ne31rl">World Setting</a> and <a href="/characters" class="alert-link svelte-ne31rl">Characters</a> before generating an outline.</div></div>'),el=C('<div class="col-12 mb-4 svelte-ne31rl"><div class="alert alert-danger mt-3 svelte-ne31rl" role="alert"> </div></div>'),tl=(e,t)=>c(t,!n(t)),rl=(e,t)=>c(t,!n(t)),al=C('<div><div class="content svelte-ne31rl"><!></div></div>'),nl=C('<div class="message assistant svelte-ne31rl"><div class="content svelte-ne31rl"><!><span class="typing-cursor svelte-ne31rl">|</span></div></div>'),sl=C('<div class="typing-indicator svelte-ne31rl"><div class="spinner svelte-ne31rl"></div> <span class="svelte-ne31rl">AI is thinking...</span></div>'),ll=C(`<div class="mb-3 svelte-ne31rl"><label for="numChapters" class="form-label svelte-ne31rl">Approximate number of chapters for the final outline:</label> <input type="number" id="numChapters" class="form-control svelte-ne31rl" min="1" max="100" step="1"></div> <div class="card chat-card svelte-ne31rl"><div class="card-header bg-primary text-white svelte-ne31rl"><h3 class="h5 mb-0 svelte-ne31rl">Outline Building Chat</h3></div> <div class="chat-container card-body svelte-ne31rl"><p class="lead svelte-ne31rl">Chat here to brainstorm ideas for your outline. When you're ready, click "Finalize
								Outline" to generate a structured outline based on the conversation.</p> <div class="chat-messages-area svelte-ne31rl"><!> <!> <!></div> <div class="input-container d-flex svelte-ne31rl"><textarea class="form-control svelte-ne31rl" placeholder="Type your ideas about the outline..." rows="1"></textarea> <button class="btn btn-primary ms-2 svelte-ne31rl">Send</button></div> <div class="mt-3 text-center svelte-ne31rl"><button class="btn btn-success svelte-ne31rl">Finalize Outline</button></div></div></div>`,1),il=C('<li class="list-group-item svelte-ne31rl"><strong class="svelte-ne31rl"> </strong> <p class="text-muted small mb-0 svelte-ne31rl"> </p></li>'),ol=C('<div class="mt-3 svelte-ne31rl"><h4 class="svelte-ne31rl">Generated Chapters:</h4> <button class="btn btn-sm btn-secondary mb-2 svelte-ne31rl">Regenerate Chapters from Outline</button> <ul class="list-group list-group-flush svelte-ne31rl"></ul></div>'),cl=C('<div class="card results-card svelte-ne31rl"><div class="card-header bg-success text-white svelte-ne31rl"><h3 class="h5 mb-0 svelte-ne31rl">Your Outline</h3></div> <div class="card-body svelte-ne31rl"><p class="lead svelte-ne31rl">Here is the generated outline. You can edit it directly.</p> <div class="form-group mb-3 svelte-ne31rl"><label for="outlineContent" class="form-label svelte-ne31rl">Edit your outline:</label> <textarea id="outlineContent" rows="15" class="form-control svelte-ne31rl"></textarea></div> <div class="d-flex justify-content-between align-items-center svelte-ne31rl"><button class="save-button btn btn-success svelte-ne31rl">Save Outline</button> <a href="/chapters" class="btn btn-primary svelte-ne31rl">Continue to Chapters</a></div> <!></div></div>'),vl=C('<div class="col-12 svelte-ne31rl"><div class="context-accordion mb-4 svelte-ne31rl"><div class="accordion svelte-ne31rl" id="contextAccordion"><div class="accordion-item svelte-ne31rl"><h2 class="accordion-header svelte-ne31rl" id="worldContextHeading"><button class="accordion-button collapsed svelte-ne31rl" type="button" data-bs-toggle="collapse" data-bs-target="#worldContextCollapse" aria-controls="worldContextCollapse">World Setting</button></h2> <div id="worldContextCollapse" aria-labelledby="worldContextHeading" data-bs-parent="#contextAccordion"><div class="accordion-body small svelte-ne31rl"><p class="svelte-ne31rl"> </p></div></div></div> <div class="accordion-item svelte-ne31rl"><h2 class="accordion-header svelte-ne31rl" id="charactersContextHeading"><button class="accordion-button collapsed svelte-ne31rl" type="button" data-bs-toggle="collapse" data-bs-target="#charactersContextCollapse" aria-controls="charactersContextCollapse">Characters</button></h2> <div id="charactersContextCollapse" aria-labelledby="charactersContextHeading" data-bs-parent="#contextAccordion"><div class="accordion-body small svelte-ne31rl"><p class="svelte-ne31rl"> </p></div></div></div></div></div> <!></div>'),dl=C(`<div class="outline-container svelte-ne31rl"><div class="row svelte-ne31rl"><div class="col-12 mb-4 svelte-ne31rl"><div class="card svelte-ne31rl"><div class="card-header bg-primary text-white d-flex justify-content-between align-items-center svelte-ne31rl"><h1 class="h4 mb-0 svelte-ne31rl">Develop Outline</h1> <div class="navigation-buttons svelte-ne31rl"><a href="/characters" class="btn btn-light svelte-ne31rl">&laquo; Previous: Characters</a> <!></div></div> <div class="card-body svelte-ne31rl"><p class="lead svelte-ne31rl">Chat with the AI to brainstorm and refine your book's outline. You can generate a full
						outline and then break it down into individual chapters.</p></div></div></div> <!> <!> <!></div></div>`);function ul(e,t){Be(t,!0);let r=F(""),a=F(me([])),s=F(""),l=F(""),o=F(10),u=F(!1),v=F(!1),f=F(!1),_=F(me([])),b=F(""),d=F(!1),p=F(""),g=F(null),E=null;Ue(()=>{E&&(E.scrollTop=E.scrollHeight)});async function I(){if(!n(b).trim()||n(d))return;const k={role:"user",content:n(b)};c(_,[...n(_),k],!0),c(b,""),c(d,!0),c(p,""),c(g,null);const N={chat_history:n(_),world_theme:n(s),characters:n(l),num_chapters:n(o)};let X=new AbortController,D=X.signal;try{const q=await fetch("/outline_chat_stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N),signal:D});if(!q.ok||!q.body){const L=await q.text();throw new Error(`HTTP error! status: ${q.status}: ${L}`)}const S=q.body.getReader(),W=new TextDecoder;let x="";for(;;){const{value:L,done:J}=await S.read();if(J||(W.decode(L).split(`

`).filter(Boolean).forEach(ee=>{if(ee.includes("[STREAMING ERROR: ")){console.error("Received streaming error:",ee),c(g,`AI streaming error: ${ee.substring(ee.indexOf("[STREAMING ERROR: "))}`),c(d,!1),X.abort();return}if(ee.startsWith("data: "))try{const U=ee.substring(6);if(U==="[DONE]")return;const ie=JSON.parse(U);ie.content!==void 0&&(x+=ie.content,c(p,x,!0))}catch(U){console.error("Error parsing JSON from stream:",U,jsonData),c(g,"Failed to parse AI response chunk.")}}),D.aborted))break}n(g)||c(_,[...n(_),{role:"assistant",content:x}],!0)}catch(q){q.name==="AbortError"?console.log("Fetch aborted due to streaming error."):(console.error("Fetch error for chat stream:",q),c(g,`Fetch or stream error: ${q.message}`),c(_,[...n(_),{role:"system",content:`Error: ${q.message}`}],!0))}finally{n(g)||(c(d,!1),c(p,""))}}function R(k){return k.split(`

`).map(N=>N.startsWith("```")?`<pre><code>${N.substring(3).replace("```","")}</code></pre>`:`<p>${N}</p>`).join("")}let A=ze(()=>n(_).filter(k=>k.role==="user").length===0||n(d));const j="Based on the world setting and characters, what kind of plot outline or story beats are you thinking of?";Ue(()=>{async function k(){try{const N=await fetch("/api/world");if(!N.ok)throw new Error("Failed to fetch world data");const X=await N.json();c(s,X.world_theme||"No world theme set.",!0);const D=await fetch("/api/characters");if(!D.ok)throw new Error("Failed to fetch characters data");const q=await D.json();c(l,q.characters||"No characters set.",!0);const S=await fetch("/api/outline");if(!S.ok)c(_,[{role:"assistant",content:j}],!0),c(f,!1);else{const W=await S.json();c(r,W.outline||"",!0),n(r)?c(f,!0):(c(_,[{role:"assistant",content:j}],!0),c(f,!1))}}catch(N){console.error("Error loading context data:",N),c(_,[{role:"system",content:`Error loading context data: ${N.message}`},{role:"assistant",content:j}],!0),c(f,!1)}}k()});async function y(){if(!n(r)){alert("Please finalize the outline first.");return}c(d,!0),c(a,[],!0);let k="";c(g,null);const N={outline:n(r)};let X=new AbortController,D=X.signal;try{const q=await fetch("/regenerate_chapters_stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N),signal:D});if(!q.ok||!q.body){const x=await q.text();throw new Error(`HTTP error! status: ${q.status}: ${x}`)}const S=q.body.getReader(),W=new TextDecoder;for(;;){const{value:x,done:L}=await S.read();if(L)break;const J=W.decode(x);if(k+=J,J.includes("[STREAMING ERROR: ")){console.error("Received streaming error:",J),c(g,`AI streaming error: ${J.substring(J.indexOf("[STREAMING ERROR: "))}`),c(d,!1),X.abort();return}}n(g)}catch(q){q.name==="AbortError"?console.log("Fetch aborted due to streaming error."):(console.error("Fetch error for regenerating chapters:",q),alert(`Failed to regenerate chapters: ${q.message}`),c(a,[],!0),c(g,`Failed to regenerate chapters: ${q.message}`))}finally{n(g)||c(d,!1)}}var w=dl(),T=i(w),$=i(T),Y=i($),H=i(Y),B=h(i(H),2),V=h(i(B),2);{var re=k=>{var N=Xs();m(k,N)};P(V,k=>{n(a).length>0&&k(re)})}var Z=h($,2);{var ce=k=>{var N=Qs();m(k,N)};P(Z,k=>{(!n(s)||!n(l))&&k(ce)})}var O=h(Z,2);{var M=k=>{var N=el(),X=i(N),D=i(X);G(()=>te(D,n(g))),m(k,N)};P(O,k=>{n(g)&&k(M)})}var K=h(O,2);{var z=k=>{var N=vl(),X=i(N),D=i(X),q=i(D),S=i(q),W=i(S);W.__click=[tl,u];var x=h(S,2);let L;var J=i(x),ae=i(J),ee=i(ae),U=h(q,2),ie=i(U),ge=i(ie);ge.__click=[rl,v];var de=h(ie,2);let ue;var he=i(de),je=i(he),_e=i(je),Je=h(X,2);{var ot=ye=>{var Pe=ll(),le=$e(Pe),ve=h(i(le),2),Q=h(le,2),pe=h(i(Q),2),Se=h(i(pe),2),Xe=i(Se);rt(Xe,17,()=>n(_),oe=>oe.role+oe.content,(oe,Ye)=>{var nt=al(),ir=i(nt),ya=i(ir);Tt(ya,()=>R(n(Ye).content)),G(()=>be(nt,1,`message ${n(Ye).role??""}`,"svelte-ne31rl")),m(oe,nt)});var vt=h(Xe,2);{var at=oe=>{var Ye=nl(),nt=i(Ye),ir=i(nt);Tt(ir,()=>R(n(p))),m(oe,Ye)};P(vt,oe=>{n(p)&&oe(at)})}var Rt=h(vt,2);{var qt=oe=>{var Ye=sl();m(oe,Ye)};P(Rt,oe=>{n(d)&&!n(p)&&oe(qt)})}lr(Se,oe=>E=oe,()=>E);var Dt=h(Se,2),dt=i(Dt),yt=h(dt,2);yt.__click=I;var $t=h(Dt,2),wt=i($t);wt.__click=[Ks,_,A,d,p,r,g,s,l,o,a,f],G(()=>{dt.disabled=n(d),yt.disabled=n(d),wt.disabled=n(A)}),qe(ve,()=>n(o),oe=>c(o,oe)),sr("keypress",dt,oe=>{oe.key==="Enter"&&!oe.shiftKey&&(oe.preventDefault(),I())}),qe(dt,()=>n(b),oe=>c(b,oe)),m(ye,Pe)},ct=ye=>{var Pe=cl(),le=h(i(Pe),2),ve=h(i(le),2),Q=h(i(ve),2),pe=h(ve,2),Se=i(pe);Se.__click=[Zs,r];var Xe=h(pe,2);{var vt=at=>{var Rt=ol(),qt=h(i(Rt),2);qt.__click=y;var Dt=h(qt,2);rt(Dt,21,()=>n(a),bt,(dt,yt)=>{var $t=il(),wt=i($t),oe=i(wt),Ye=h(wt,2),nt=i(Ye);G(()=>{te(oe,n(yt).title),te(nt,n(yt).summary)}),m(dt,$t)}),m(at,Rt)};P(Xe,at=>{n(a).length>0&&at(vt)})}qe(Q,()=>n(r),at=>c(r,at)),m(ye,Pe)};P(Je,ye=>{n(f)?ye(ct,!1):ye(ot)})}G((ye,Pe)=>{Me(W,"aria-expanded",n(u)),L=be(x,1,"accordion-collapse collapse svelte-ne31rl",null,L,ye),te(ee,n(s)),Me(ge,"aria-expanded",n(v)),ue=be(de,1,"accordion-collapse collapse svelte-ne31rl",null,ue,Pe),te(_e,n(l))},[()=>({show:n(u)}),()=>({show:n(v)})]),m(k,N)};P(K,k=>{n(s)&&n(l)&&k(z)})}m(e,w),Ge()}Ie(["click"]);async function Mr(e,t,r,a){c(t,!0),c(r,"");try{const l=await fetch(`/chapter/${a().chapter_number}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chapter_number:a().chapter_number,additional_context:""})});if(!l.ok){const u=await l.text();throw new Error(`Failed to generate chapter: ${l.status} ${l.statusText} - ${u}`)}const o=await l.json();a().content=o.chapter_content,console.log("Chapter generated. Snippet:",o.chapter_content.slice(0,100)+"...")}catch(s){console.error("Generation error:",s),s instanceof Error?c(r,s.message,!0):c(r,"An unknown error occurred during generation.")}finally{c(t,!1)}}async function fl(e,t){if(t().content===void 0||t().content===null){console.warn("No content to save.");return}try{const r=await fetch(`/save_chapter/${t().chapter_number}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chapter_content:t().content})});if(!r.ok){const a=await r.text();throw new Error(`Failed to save chapter: ${r.status} ${r.statusText} - ${a}`)}console.log("Chapter saved successfully!")}catch(r){console.error("Save error:",r),r instanceof Error?console.error("Save failed:",r.message):console.error("An unknown error occurred during saving.")}}async function hl(e,t,r,a,s,l){if(!t().content||t().content.trim()===""){c(r,"No chapter content to read. Please generate content first.");return}c(a,!0),c(r,""),c(s,null);try{const o=await fetch(`/api/tts/chapter/${t().chapter_number}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chapter_number:t().chapter_number,voice:n(l),response_format:"mp3"})});if(!o.ok){const v=await o.text();throw new Error(`Failed to generate audio: ${o.status} ${o.statusText} - ${v}`)}const u=await o.json();if(u.success)c(s,`/static/chapters/chapter_${t().chapter_number}.mp3?t=${Date.now()}`),console.log("Chapter audio generated successfully:",u.filename);else throw new Error(u.error||"Failed to generate audio")}catch(o){console.error("TTS generation error:",o),o instanceof Error?c(r,o.message,!0):c(r,"An unknown error occurred during audio generation.")}finally{c(a,!1)}}var _l=C('<div class="alert alert-info mt-2" role="status"><span class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span> Generating chapter content...</div>'),pl=C('<div class="alert alert-danger mt-2"> </div>'),bl=C('<p class="card-text small"><!></p> <button class="btn btn-sm btn-primary"><!></button> <!> <!>',1),gl=C("<option> </option>"),ml=C('<span class="spinner-border spinner-border-sm me-1"></span> Generating Audio...',1),yl=C('<div class="mt-2"><audio controls class="w-100"><source type="audio/mpeg"> Your browser does not support the audio element.</audio></div>'),wl=C('<div class="alert alert-warning alert-sm mt-2"> </div>'),xl=C('<div class="border rounded p-3 mb-3 bg-light"><h6>Text-to-Speech</h6> <div class="row align-items-center mb-2"><div class="col-md-6"><label class="form-label small">Voice:</label> <select class="form-select form-select-sm"><option>Emma (British Female)</option><!></select></div> <div class="col-md-6"><label class="form-label small">&nbsp;</label> <div><button class="btn btn-primary btn-sm"><!></button></div></div></div> <!> <!></div>'),El=C('<div class="alert alert-info"><small>TTS server unavailable. Start Kokoro-FastAPI to enable chapter reading.</small></div>'),kl=C('<div class="alert alert-secondary"><small>Checking TTS availability...</small></div>'),Cl=C('<div class="alert alert-info mt-2" role="status"><span class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span> Regenerating chapter content...</div>'),Tl=C('<div class="alert alert-danger mt-2"> </div>'),Sl=C('<p class="card-text small text-muted mb-3">Outline: <!></p> <div class="mb-3"><label class="form-label">Chapter Content:</label> <textarea class="form-control" rows="20"></textarea></div> <div class="d-flex justify-content-between mb-3"><button class="btn btn-success">Save Chapter</button> <button class="btn btn-warning"><!></button></div> <!> <!> <!>',1),Ol=C('<div class="card h-100"><div class="card-body"><h4 class="h6 card-title"> </h4> <!></div></div>');function Al(e,t){Be(t,!0);let r=fe(t,"chapter",7),a=F(!1),s=F(""),l=F(!1),o=F(""),u=F(me([])),v=F("bf_emma"),f=F(null),_=F("checking");async function b(){try{const w=await(await fetch("/api/tts/status")).json();c(_,w.status==="available"?"available":"unavailable",!0),n(_)==="available"&&await d()}catch(y){console.error("TTS status check failed:",y),c(_,"unavailable")}}async function d(){try{const w=await(await fetch("/api/tts/voices")).json();if(w.error){console.error("Failed to load voices:",w.error);return}c(u,Object.entries(w.voices||{}).map(([T,$])=>({id:T,name:$})),!0)}catch(y){console.error("Failed to load voices:",y)}}Ue(()=>{b()});var p=Ol(),g=i(p),E=i(g),I=i(E),R=h(E,2);{var A=y=>{var w=bl(),T=$e(w),$=i(T);{var Y=z=>{var k=ke();G(N=>te(k,`${N??""}...`),[()=>r().prompt.slice(0,100)]),m(z,k)},H=z=>{var k=ke();G(()=>te(k,r().prompt)),m(z,k)};P($,z=>{r().prompt.length>100?z(Y):z(H,!1)})}var B=h(T,2);B.__click=[Mr,a,s,r];var V=i(B);{var re=z=>{var k=ke("Generating...");m(z,k)},Z=z=>{var k=ke("Generate Chapter");m(z,k)};P(V,z=>{n(a)?z(re):z(Z,!1)})}var ce=h(B,2);{var O=z=>{var k=_l();m(z,k)};P(ce,z=>{n(a)&&z(O)})}var M=h(ce,2);{var K=z=>{var k=pl(),N=i(k);G(()=>te(N,`Error: ${n(s)??""}`)),m(z,k)};P(M,z=>{n(s)&&z(K)})}G(()=>B.disabled=n(a)),m(y,w)},j=y=>{var w=Sl(),T=$e(w),$=h(i(T));{var Y=x=>{var L=ke();G(J=>te(L,`${J??""}...`),[()=>r().prompt.slice(0,100)]),m(x,L)},H=x=>{var L=ke();G(()=>te(L,r().prompt)),m(x,L)};P($,x=>{r().prompt.length>100?x(Y):x(H,!1)})}var B=h(T,2),V=i(B),re=h(V,2),Z=h(B,2),ce=i(Z);ce.__click=[fl,r];var O=h(ce,2);O.__click=[Mr,a,s,r];var M=i(O);{var K=x=>{var L=ke("Regenerating...");m(x,L)},z=x=>{var L=ke("Regenerate Chapter");m(x,L)};P(M,x=>{n(a)?x(K):x(z,!1)})}var k=h(Z,2);{var N=x=>{var L=xl(),J=h(i(L),2),ae=i(J),ee=i(ae),U=h(ee,2),ie=i(U);ie.value=ie.__value="bf_emma";var ge=h(ie);rt(ge,17,()=>n(u),bt,(le,ve)=>{var Q=gl(),pe={},Se=i(Q);G(()=>{pe!==(pe=n(ve).id)&&(Q.value=(Q.__value=n(ve).id)??""),te(Se,n(ve).name)}),m(le,Q)});var de=h(ae,2),ue=h(i(de),2),he=i(ue);he.__click=[hl,r,o,l,f,v];var je=i(he);{var _e=le=>{var ve=ml();m(le,ve)},Je=le=>{var ve=ke("🔊 Read Chapter");m(le,ve)};P(je,le=>{n(l)?le(_e):le(Je,!1)})}var ot=h(J,2);{var ct=le=>{var ve=yl(),Q=i(ve),pe=i(Q);G(()=>Me(pe,"src",n(f))),m(le,ve)};P(ot,le=>{n(f)&&le(ct)})}var ye=h(ot,2);{var Pe=le=>{var ve=wl(),Q=i(ve);G(()=>te(Q,n(o))),m(le,ve)};P(ye,le=>{n(o)&&le(Pe)})}G(()=>{Me(ee,"for",`voiceSelect_${r().chapter_number??""}`),Me(U,"id",`voiceSelect_${r().chapter_number??""}`),he.disabled=n(l)}),ga(U,()=>n(v),le=>c(v,le)),m(x,L)},X=(x,L)=>{{var J=ee=>{var U=El();m(ee,U)},ae=ee=>{var U=kl();m(ee,U)};P(x,ee=>{n(_)==="unavailable"?ee(J):ee(ae,!1)},L)}};P(k,x=>{n(_)==="available"?x(N):x(X,!1)})}var D=h(k,2);{var q=x=>{var L=Cl();m(x,L)};P(D,x=>{n(a)&&x(q)})}var S=h(D,2);{var W=x=>{var L=Tl(),J=i(L);G(()=>te(J,`Error: ${n(s)??""}`)),m(x,L)};P(S,x=>{n(s)&&x(W)})}G(()=>{Me(V,"for",`chapterContent_${r().chapter_number??""}`),Me(re,"id",`chapterContent_${r().chapter_number??""}`),O.disabled=n(a)}),qe(re,()=>r().content,x=>r().content=x),m(y,w)};P(R,y=>{r().content?y(j,!1):y(A)})}G(()=>te(I,`Chapter ${r().chapter_number??""}: ${r().title??""}`)),m(e,p),Ge()}Ie(["click"]);var Pl=C('<div class="project-view svelte-cfvzq0"><h1 class="svelte-cfvzq0">Project View</h1> <p> </p> <p>This will show the specific project interface.</p></div>'),Rl=(e,t)=>{window.history.pushState({},"","/"),c(t,"/")},ql=C(`<div class="not-found svelte-cfvzq0"><h1 class="svelte-cfvzq0">Page Not Found</h1> <p class="svelte-cfvzq0">The page you're looking for doesn't exist.</p> <button class="svelte-cfvzq0">Go to Dashboard</button></div>`),Dl=C("<!> <main><!></main>",1);function $l(e,t){Be(t,!0);let r=F(me(window.location.pathname));ma(()=>{const g=()=>{c(r,window.location.pathname,!0)};return window.addEventListener("popstate",g),()=>{window.removeEventListener("popstate",g)}});const a=ze(()=>n(r)==="/"||n(r)==="/dashboard"),s=ze(()=>["/world","/characters","/outline","/chapters"].includes(n(r))),l=ze(()=>n(r).startsWith("/project/"));var o=Dl(),u=$e(o);{var v=g=>{_s(g,{})};P(u,g=>{n(s)&&g(v)})}var f=h(u,2);let _;var b=i(f);{var d=g=>{os(g,{})},p=(g,E)=>{{var I=A=>{var j=Ut(),y=$e(j);{var w=$=>{$s($,{})},T=($,Y)=>{{var H=V=>{Us(V,{})},B=(V,re)=>{{var Z=O=>{ul(O,{})},ce=(O,M)=>{{var K=z=>{Al(z,{})};P(O,z=>{n(r)==="/chapters"&&z(K)},M)}};P(V,O=>{n(r)==="/outline"?O(Z):O(ce,!1)},re)}};P($,V=>{n(r)==="/characters"?V(H):V(B,!1)},Y)}};P(y,$=>{n(r)==="/world"?$(w):$(T,!1)})}m(A,j)},R=(A,j)=>{{var y=T=>{var $=Pl(),Y=h(i($),2),H=i(Y);G(()=>te(H,`Project route: ${n(r)??""}`)),m(T,$)},w=T=>{var $=ql(),Y=h(i($),4);Y.__click=[Rl,r],m(T,$)};P(A,T=>{n(l)?T(y):T(w,!1)},j)}};P(g,A=>{n(s)?A(I):A(R,!1)},E)}};P(b,g=>{n(a)?g(d):g(p,!1)})}G(g=>_=be(f,1,"app-main svelte-cfvzq0",null,_,g),[()=>({"with-nav":n(s)})]),m(e,o),Ge()}Ie(["click"]);xn($l,{target:document.getElementById("app")});
